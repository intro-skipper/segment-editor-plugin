const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/jassub-BtnWmffD.js","assets/react-vendor-NRF3IDaz.js"])))=>i.map(i=>d[i]);
import{a as d,j as n,v as _r,x as Nr}from"./tanstack-vendor-DcxxohBG.js";import{j as mr,c as je,u as Lt,a as H,k as $e,D as Js,l as Qs,m as Xs,n as vs,B as ve,o as Ss,p as Ts,q as ks,P as ys,r as gr,_ as Ir,s as Pr,t as Ks,v as Vs,J as Rr,w as Ar,x as gs,y as _t,z as Dr,A as zt,E as $t,F as Mr,G as pr,H as Lr,I as Fr,K as zr,L as Hs,N as $r,O as Gs,Q as hr,T as ws,U as Ur,W as Or,X as Vr,Y as Hr,Z as Br,$ as Kr,a0 as bs,a1 as Gr,a2 as Wr,a3 as Yr,a4 as qr,a5 as Jr,a6 as Qr,a7 as Xr,a8 as Zr,a9 as fs,aa as Zs,ab as er,h as en,S as Ls}from"./index-RpOviJkQ.js";import{u as ps}from"./i18n-vendor-WjpEjhp3.js";import{aq as tn,aj as sn,ar as tr,C as Fs,as as rn,at as nn,P as Bs,au as an,av as ln,aw as on,ax as cn,ay as un,az as dn,aA as fn,aB as mn,x as gn,R as zs,aC as pn,aD as yr,aE as xr,aF as hn,j as yn,l as xn,m as bn,n as vn,k as Sn,o as Tn,aG as br,aH as kn,L as wn}from"./ui-vendor-Be58-Sc0.js";import{s as $s,a as sr,b as En,c as jn,d as Cn,g as vr,u as _n,F as Nn}from"./feature-error-boundary-BEcF-gHJ.js";import{H as ms}from"./hls-vendor-Cp2x8l1r.js";import{a as Sr,S as In}from"./async-state-BuZcYrLg.js";import{R as Pn}from"./route-error-fallback-D8To7R5p.js";import{u as Rn}from"./use-vibrant-color-0LLACAur.js";import"./react-vendor-NRF3IDaz.js";import"./jellyfin-vendor-C-_X6ALD.js";import"./media-vendor-CUSAIUeh.js";const{KEYBOARD_STEP_FINE:An,KEYBOARD_STEP_COARSE:Dn}=mr;function Ws(s,t,e){const{min:r,max:a,value:l,gap:o=0,stepFine:u=An,stepCoarse:c=Dn}=e,m=t?c:u,f=a-o;let i=l,S=!0;switch(s){case"ArrowLeft":i=Math.max(r,l-m);break;case"ArrowRight":i=Math.min(f,l+m);break;case"Home":i=r;break;case"End":i=f;break;default:S=!1}return{handled:S,newValue:i}}function Mn(s,t,e,r,a){return Ws(s,t,{min:0,max:r,value:e,gap:a})}function Ln(s,t,e,r,a,l){const o=Ws(s,t,{min:e,max:a,value:r,gap:l});return s==="Home"?o.newValue=e+l:s==="End"&&(o.newValue=a),o}function Fn(s){return s?s instanceof HTMLInputElement||s instanceof HTMLTextAreaElement||s instanceof HTMLElement&&s.isContentEditable:!1}const zn=5,$n=10,Un=s=>s.vibrantColors;function On(s){const t=je.c(92),{currentTime:e,duration:r,buffered:a,onSeek:l,className:o}=s,u=a===void 0?0:a,c=Lt(Un),m=d.useRef(null),[f,i]=d.useState(!1),[S,T]=d.useState(null),[p,w]=d.useState(0),N=r>0?e/r*100:0,b=r>0?u/r*100:0;let x;t[0]!==r?(x=V=>{const re=m.current;if(!re||r<=0)return 0;const Q=re.getBoundingClientRect();return Math.max(0,Math.min(V-Q.left,Q.width))/Q.width*r},t[0]=r,t[1]=x):x=t[1];const g=x;let j;t[2]!==g||t[3]!==l?(j=V=>{V.preventDefault(),V.target.setPointerCapture(V.pointerId),i(!0),l(g(V.clientX))},t[2]=g,t[3]=l,t[4]=j):j=t[4];const h=j;let I;t[5]!==g||t[6]!==f||t[7]!==l?(I=V=>{const re=m.current;if(!re)return;const Q=re.getBoundingClientRect(),Ne=Math.max(0,Math.min(V.clientX-Q.left,Q.width));T(g(V.clientX)),w(Ne),f&&l(g(V.clientX))},t[5]=g,t[6]=f,t[7]=l,t[8]=I):I=t[8];const A=I;let F;t[9]===Symbol.for("react.memo_cache_sentinel")?(F=V=>{V.target.releasePointerCapture(V.pointerId),i(!1)},t[9]=F):F=t[9];const v=F;let D;t[10]===Symbol.for("react.memo_cache_sentinel")?(D=()=>{T(null)},t[10]=D):D=t[10];const G=D;let y;t[11]!==e||t[12]!==r||t[13]!==l?(y=V=>{if(r<=0)return;const re=Ws(V.key,V.shiftKey,{min:0,max:r,value:e,stepFine:zn,stepCoarse:$n});re.handled&&(V.preventDefault(),l(re.newValue))},t[11]=e,t[12]=r,t[13]=l,t[14]=y):y=t[14];const C=y;let M;t[15]!==c?(M=c?{backgroundColor:c.primary+"30"}:void 0,t[15]=c,t[16]=M):M=t[16];const $=M;let B;t[17]!==N||t[18]!==c?.accent?(B=()=>({width:`${N}%`,backgroundColor:c?.accent}),t[17]=N,t[18]=c?.accent,t[19]=B):B=t[19],c?.accent;let U;t[20]!==B?(U=B(),t[20]=B,t[21]=U):U=t[21];const X=U,W=`${N}%`,Y=c?.accent,L=c?`0 0 0 2px ${c.primary}40, 0 4px 6px -1px rgba(0, 0, 0, 0.1)`:void 0;let Z;t[22]!==W||t[23]!==Y||t[24]!==L?(Z={left:W,backgroundColor:Y,boxShadow:L,transform:"translate(-50%, -50%)"},t[22]=W,t[23]=Y,t[24]=L,t[25]=Z):Z=t[25];const q=Z,_=`${b}%`;let P;t[26]!==_?(P={width:_},t[26]=_,t[27]=P):P=t[27];const O=P;let R;t[28]!==p?(R={left:p,transform:"translateX(-50%)"},t[28]=p,t[29]=R):R=t[29];const K=R;let ae;t[30]!==o?(ae=H("flex items-center gap-3",o),t[30]=o,t[31]=ae):ae=t[31];let te;t[32]!==e?(te=$e(e),t[32]=e,t[33]=te):te=t[33];let ue;t[34]!==te?(ue=n.jsx("span",{className:"text-xs text-muted-foreground font-mono min-w-[var(--spacing-time-display)]",children:te}),t[34]=te,t[35]=ue):ue=t[35];let le;t[36]===Symbol.for("react.memo_cache_sentinel")?(le={contain:"layout style"},t[36]=le):le=t[36];let E;t[37]!==r?(E=Math.round(r),t[37]=r,t[38]=E):E=t[38];let pe;t[39]!==e?(pe=Math.round(e),t[39]=e,t[40]=pe):pe=t[40];let ee;t[41]!==e?(ee=$e(e),t[41]=e,t[42]=ee):ee=t[42];let Se;t[43]!==r?(Se=$e(r),t[43]=r,t[44]=Se):Se=t[44];const ie=`${ee} of ${Se}`,he=!c&&"bg-muted";let de;t[45]!==he?(de=H("absolute inset-0 rounded-full overflow-hidden",he),t[45]=he,t[46]=de):de=t[46];let ne;t[47]!==O?(ne=n.jsx("div",{className:"absolute inset-y-0 left-0 bg-muted-foreground/30 rounded-full",style:O}),t[47]=O,t[48]=ne):ne=t[48];const we=!c&&"bg-primary";let fe;t[49]!==we?(fe=H("absolute inset-y-0 left-0 rounded-full",we),t[49]=we,t[50]=fe):fe=t[50];let oe;t[51]!==X||t[52]!==fe?(oe=n.jsx("div",{className:fe,style:X}),t[51]=X,t[52]=fe,t[53]=oe):oe=t[53];let z;t[54]!==de||t[55]!==ne||t[56]!==oe||t[57]!==$?(z=n.jsxs("div",{className:de,style:$,children:[ne,oe]}),t[54]=de,t[55]=ne,t[56]=oe,t[57]=$,t[58]=z):z=t[58];const Ie=S!==null?"opacity-100":"opacity-0";let Ce;t[59]!==Ie?(Ce=H("absolute top-0 w-0.5 h-full bg-white/50 pointer-events-none transition-opacity",Ie),t[59]=Ie,t[60]=Ce):Ce=t[60];let Te;t[61]!==K||t[62]!==Ce?(Te=n.jsx("div",{className:Ce,style:K}),t[61]=K,t[62]=Ce,t[63]=Te):Te=t[63];const _e=!c&&"bg-primary";let me;t[64]!==_e?(me=H("absolute top-1/2 w-4 h-4 rounded-full shadow-md transition-transform group-hover:scale-110",_e),t[64]=_e,t[65]=me):me=t[65];let se;t[66]!==me||t[67]!==q?(se=n.jsx("div",{className:me,style:q}),t[66]=me,t[67]=q,t[68]=se):se=t[68];let ce;t[69]!==K||t[70]!==S?(ce=S!==null&&n.jsx("div",{className:"absolute -top-8 bg-popover text-popover-foreground text-xs px-2 py-1 rounded shadow-lg pointer-events-none",style:K,children:$e(S)}),t[69]=K,t[70]=S,t[71]=ce):ce=t[71];let ge;t[72]!==C||t[73]!==h||t[74]!==A||t[75]!==E||t[76]!==pe||t[77]!==ie||t[78]!==z||t[79]!==Te||t[80]!==se||t[81]!==ce?(ge=n.jsxs("div",{ref:m,className:"relative flex-1 h-2 cursor-pointer group touch-none",style:le,role:"slider","aria-label":"Video progress","aria-valuemin":0,"aria-valuemax":E,"aria-valuenow":pe,"aria-valuetext":ie,"aria-orientation":"horizontal",tabIndex:0,onPointerDown:h,onPointerMove:A,onPointerUp:v,onPointerLeave:G,onKeyDown:C,children:[z,Te,se,ce]}),t[72]=C,t[73]=h,t[74]=A,t[75]=E,t[76]=pe,t[77]=ie,t[78]=z,t[79]=Te,t[80]=se,t[81]=ce,t[82]=ge):ge=t[82];let ye;t[83]!==r?(ye=$e(r),t[83]=r,t[84]=ye):ye=t[84];let Ee;t[85]!==ye?(Ee=n.jsx("span",{className:"text-xs text-muted-foreground font-mono min-w-[var(--spacing-time-display)] text-right",children:ye}),t[85]=ye,t[86]=Ee):Ee=t[86];let xe;return t[87]!==ae||t[88]!==ue||t[89]!==ge||t[90]!==Ee?(xe=n.jsxs("div",{className:ae,children:[ue,ge,Ee]}),t[87]=ae,t[88]=ue,t[89]=ge,t[90]=Ee,t[91]=xe):xe=t[91],xe}const Vn="size-5 sm:size-6",Hn=s=>s?{color:s}:void 0,Bn=(s,t)=>H("!size-12 sm:!size-12 border-2 transition-all duration-200 ease-out","",!t&&"border-border"),Kn=d.memo(function(t){const e=je.c(56),{trackState:r,onSelectAudio:a,onSelectSubtitle:l,strategy:o,disabled:u,getButtonStyle:c,iconColor:m,hasColors:f,className:i}=t,S=u===void 0?!1:u,T=f===void 0?!1:f,{t:p}=ps(),{audioTracks:w,subtitleTracks:N,activeAudioIndex:b,activeSubtitleIndex:x}=r,g=w.length>0,j=N.length>0,h=g||j,I=o==="direct",A=I?tn:sn;let F;e[0]!==a?(F=R=>{a(R)},e[0]=a,e[1]=F):F=e[1];const v=F;let D;e[2]!==l?(D=R=>{l(R)},e[2]=l,e[3]=D):D=e[3];const G=D;let y;e[4]!==p?(y=p("player.tracks.selector","Audio and subtitle tracks"),e[4]=p,e[5]=y):y=e[5];const C=S||!h;let M;e[6]!==c?(M=c?.(),e[6]=c,e[7]=M):M=e[7];let $;e[8]!==i||e[9]!==T?($=H(Bn(!1,T),i),e[8]=i,e[9]=T,e[10]=$):$=e[10];let B;e[11]!==y||e[12]!==C||e[13]!==M||e[14]!==$?(B=n.jsx(ve,{variant:"outline","aria-label":y,disabled:C,style:M,className:$}),e[11]=y,e[12]=C,e[13]=M,e[14]=$,e[15]=B):B=e[15];let U;e[16]!==m?(U=Hn(m),e[16]=m,e[17]=U):U=e[17];let X;e[18]!==U?(X=n.jsx(tr,{className:Vn,strokeWidth:2.5,"aria-hidden":"true",style:U}),e[18]=U,e[19]=X):X=e[19];let W;e[20]!==X||e[21]!==B?(W=n.jsx(Ss,{render:B,children:X}),e[20]=X,e[21]=B,e[22]=W):W=e[22];let Y;e[23]!==A||e[24]!==h||e[25]!==I||e[26]!==o||e[27]!==p?(Y=o&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"px-3 py-2",children:n.jsxs("div",{className:H("inline-flex items-center gap-1.5 px-2 py-1 rounded-md text-xs font-medium",I?"bg-emerald-500/10 text-emerald-600 border border-emerald-500/20":"bg-blue-500/10 text-blue-600 border border-blue-500/20"),role:"status","aria-label":I?p("player.strategy.direct","Direct Play - Original quality, no transcoding"):p("player.strategy.hls","HLS Streaming - Transcoded for compatibility"),children:[n.jsx(A,{className:"size-3","aria-hidden":"true"}),n.jsx("span",{children:I?p("player.strategy.directLabel","Direct Play"):p("player.strategy.hlsLabel","HLS Transcode")})]})}),h&&n.jsx(Js,{})]}),e[23]=A,e[24]=h,e[25]=I,e[26]=o,e[27]=p,e[28]=Y):Y=e[28];let L;e[29]!==b||e[30]!==w||e[31]!==v||e[32]!==g||e[33]!==p?(L=g&&n.jsxs(Qs,{children:[n.jsxs(Xs,{className:"flex items-center gap-2",children:[n.jsx(tr,{className:"size-4","aria-hidden":"true"}),p("player.tracks.audio","Audio")]}),w.map(R=>{const K=R.index===b;return n.jsxs(vs,{onClick:()=>v(R.index),className:H("flex items-center justify-between gap-2",K&&"bg-accent"),"aria-selected":K,children:[n.jsx("span",{className:"truncate",children:R.displayTitle}),K&&n.jsx(Fs,{className:"size-4 shrink-0 text-primary","aria-hidden":"true"})]},`audio-${R.index}`)})]}),e[29]=b,e[30]=w,e[31]=v,e[32]=g,e[33]=p,e[34]=L):L=e[34];let Z;e[35]!==g||e[36]!==j?(Z=g&&j&&n.jsx(Js,{}),e[35]=g,e[36]=j,e[37]=Z):Z=e[37];let q;e[38]!==x||e[39]!==G||e[40]!==j||e[41]!==N||e[42]!==p?(q=j&&n.jsxs(Qs,{children:[n.jsxs(Xs,{className:"flex items-center gap-2",children:[n.jsx(rn,{className:"size-4","aria-hidden":"true"}),p("player.tracks.subtitle","Subtitles")]}),n.jsxs(vs,{onClick:()=>G(null),className:H("flex items-center justify-between gap-2",x===null&&"bg-accent"),"aria-selected":x===null,children:[n.jsx("span",{children:p("player.tracks.off","Off")}),x===null&&n.jsx(Fs,{className:"size-4 shrink-0 text-primary","aria-hidden":"true"})]}),N.map(R=>{const K=R.index===x;return n.jsxs(vs,{onClick:()=>G(R.index),className:H("flex items-center justify-between gap-2",K&&"bg-accent"),"aria-selected":K,children:[n.jsx("span",{className:"truncate",children:R.displayTitle}),K&&n.jsx(Fs,{className:"size-4 shrink-0 text-primary","aria-hidden":"true"})]},`subtitle-${R.index}`)})]}),e[38]=x,e[39]=G,e[40]=j,e[41]=N,e[42]=p,e[43]=q):q=e[43];let _;e[44]!==h||e[45]!==p?(_=!h&&n.jsx("div",{className:"px-3 py-2 text-sm text-muted-foreground",children:p("player.tracks.noTracks","No tracks available")}),e[44]=h,e[45]=p,e[46]=_):_=e[46];let P;e[47]!==Y||e[48]!==L||e[49]!==Z||e[50]!==q||e[51]!==_?(P=n.jsxs(Ts,{align:"start",className:"min-w-[240px] max-h-[400px] overflow-y-auto",children:[Y,L,Z,q,_]}),e[47]=Y,e[48]=L,e[49]=Z,e[50]=q,e[51]=_,e[52]=P):P=e[52];let O;return e[53]!==W||e[54]!==P?(O=n.jsxs(ks,{children:[W,P]}),e[53]=W,e[54]=P,e[55]=O):O=e[55],O}),{SKIP_TIMES:Gn}=ys,kt="size-5 sm:size-6",Ct=s=>s?{color:s}:void 0,Wn=Object.freeze([{label:"Play/Pause",keys:["Space"]},{label:"Skip back/forward",keys:["A","D"]},{label:"Change skip time",keys:["W","S"]},{label:"Set start time",keys:["E"]},{label:"Set end time",keys:["F"]},{label:"Toggle mute",keys:["M"]}]),Ft=(s,t)=>H("!size-12 sm:!size-12 border-2 transition-all duration-200 ease-out",s?"rounded-[30%] duration-300":"",!t&&(s?"border-primary":"border-border")),Yn=d.memo(function(t){const e=je.c(190),{isPlaying:r,isMuted:a,volume:l,skipTimeIndex:o,vibrantColors:u,hasColors:c,iconColor:m,getButtonStyle:f,onTogglePlay:i,onToggleMute:S,onVolumeChange:T,onCreateSegment:p,onPushStartTimestamp:w,onPushEndTimestamp:N,onSkipTimeChange:b,trackState:x,onSelectAudioTrack:g,onSelectSubtitleTrack:j,isTrackSelectorDisabled:h,strategy:I,isFullscreen:A,onToggleFullscreen:F}=t,{t:v}=ps();let D;e[0]!==T?(D=be=>{T(parseFloat(be.target.value))},e[0]=T,e[1]=D):D=e[1];const G=D;let y;e[2]!==v?(y=v("player.controls","Video player controls"),e[2]=v,e[3]=y):y=e[3];let C;e[4]!==r||e[5]!==v?(C=r?v("accessibility.player.paused","Pause video"):v("accessibility.playPause","Play video"),e[4]=r,e[5]=v,e[6]=C):C=e[6];let M;e[7]!==f||e[8]!==r?(M=f(r),e[7]=f,e[8]=r,e[9]=M):M=e[9];let $;e[10]!==c||e[11]!==r?($=H(Ft(r,c),!r&&"rounded-full"),e[10]=c,e[11]=r,e[12]=$):$=e[12];let B;e[13]!==m||e[14]!==r||e[15]!==u?.accentText?(B=r?n.jsx(nn,{className:kt,fill:u?.accentText??"currentColor",strokeWidth:0,"aria-hidden":"true"}):n.jsx(Bs,{className:kt,fill:m??"currentColor",strokeWidth:0,"aria-hidden":"true",style:Ct(m)}),e[13]=m,e[14]=r,e[15]=u?.accentText,e[16]=B):B=e[16];let U;e[17]!==r||e[18]!==i||e[19]!==C||e[20]!==M||e[21]!==$||e[22]!==B?(U=n.jsx(ve,{variant:"outline",onClick:i,"aria-label":C,"aria-pressed":r,style:M,className:$,children:B}),e[17]=r,e[18]=i,e[19]=C,e[20]=M,e[21]=$,e[22]=B,e[23]=U):U=e[23];let X;e[24]!==a||e[25]!==v||e[26]!==l?(X=a||l===0?v("accessibility.player.muted","Volume muted"):v("player.volume","Volume"),e[24]=a,e[25]=v,e[26]=l,e[27]=X):X=e[27];let W;e[28]!==f?(W=f(),e[28]=f,e[29]=W):W=e[29];let Y;e[30]!==c?(Y=Ft(!1,c),e[30]=c,e[31]=Y):Y=e[31];let L;e[32]!==Y||e[33]!==X||e[34]!==W?(L=n.jsx(ve,{variant:"outline","aria-label":X,style:W,className:Y}),e[32]=Y,e[33]=X,e[34]=W,e[35]=L):L=e[35];let Z;e[36]!==m||e[37]!==a||e[38]!==l?(Z=a||l===0?n.jsx(on,{className:kt,strokeWidth:2.5,"aria-hidden":"true",style:Ct(m)}):n.jsx(cn,{className:kt,strokeWidth:2.5,"aria-hidden":"true",style:Ct(m)}),e[36]=m,e[37]=a,e[38]=l,e[39]=Z):Z=e[39];let q;e[40]!==L||e[41]!==Z?(q=n.jsx(Ss,{render:L,children:Z}),e[40]=L,e[41]=Z,e[42]=q):q=e[42];const _=a?0:l;let P;e[43]!==v?(P=v("player.volumeSlider"),e[43]=v,e[44]=P):P=e[44];let O;e[45]!==a||e[46]!==l?(O=Math.round((a?0:l)*100),e[45]=a,e[46]=l,e[47]=O):O=e[47];let R;e[48]!==a||e[49]!==l?(R=Math.round((a?0:l)*100),e[48]=a,e[49]=l,e[50]=R):R=e[50];const K=`${R}%`;let ae;e[51]!==G||e[52]!==_||e[53]!==P||e[54]!==O||e[55]!==K?(ae=n.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:_,onChange:G,"aria-label":P,"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":O,"aria-valuetext":K,className:"h-24 w-2 appearance-none bg-muted rounded-full cursor-pointer [writing-mode:vertical-lr] [direction:rtl]"}),e[51]=G,e[52]=_,e[53]=P,e[54]=O,e[55]=K,e[56]=ae):ae=e[56];let te;e[57]!==a||e[58]!==v?(te=v(a?"player.unmute":"player.mute"),e[57]=a,e[58]=v,e[59]=te):te=e[59];let ue;e[60]!==S||e[61]!==te?(ue=n.jsx(ve,{variant:"ghost",size:"sm",onClick:S,className:"text-xs",children:te}),e[60]=S,e[61]=te,e[62]=ue):ue=e[62];let le;e[63]!==ae||e[64]!==ue?(le=n.jsx(Ts,{align:"start",className:"p-4",children:n.jsxs("div",{className:"flex flex-col gap-2 items-center",children:[ae,ue]})}),e[63]=ae,e[64]=ue,e[65]=le):le=e[65];let E;e[66]!==q||e[67]!==le?(E=n.jsxs(ks,{children:[q,le]}),e[66]=q,e[67]=le,e[68]=E):E=e[68];let pe;e[69]!==v?(pe=v("editor.newSegment"),e[69]=v,e[70]=pe):pe=e[70];let ee;e[71]!==f?(ee=f(),e[71]=f,e[72]=ee):ee=e[72];let Se;e[73]!==c?(Se=Ft(!1,c),e[73]=c,e[74]=Se):Se=e[74];let ie;e[75]!==pe||e[76]!==ee||e[77]!==Se?(ie=n.jsx(ve,{variant:"outline","aria-label":pe,style:ee,className:Se}),e[75]=pe,e[76]=ee,e[77]=Se,e[78]=ie):ie=e[78];let he;e[79]!==m?(he=Ct(m),e[79]=m,e[80]=he):he=e[80];let de;e[81]!==he?(de=n.jsx(un,{className:kt,strokeWidth:3,"aria-hidden":"true",style:he}),e[81]=he,e[82]=de):de=e[82];let ne;e[83]!==ie||e[84]!==de?(ne=n.jsx(Ss,{render:ie,children:de}),e[83]=ie,e[84]=de,e[85]=ne):ne=e[85];let we;e[86]!==p?(we=gr.map(be=>n.jsx(vs,{onClick:()=>p(be),children:be},be)),e[86]=p,e[87]=we):we=e[87];let fe;e[88]!==we?(fe=n.jsx(Ts,{align:"start",children:we}),e[88]=we,e[89]=fe):fe=e[89];let oe;e[90]!==ne||e[91]!==fe?(oe=n.jsxs(ks,{children:[ne,fe]}),e[90]=ne,e[91]=fe,e[92]=oe):oe=e[92];let z;e[93]!==v?(z=v("accessibility.seekToStart"),e[93]=v,e[94]=z):z=e[94];let Ie;e[95]!==v?(Ie=v("accessibility.seekToStart"),e[95]=v,e[96]=Ie):Ie=e[96];const Ce=`${Ie} (E)`;let Te;e[97]!==f?(Te=f(),e[97]=f,e[98]=Te):Te=e[98];let _e;e[99]!==c?(_e=Ft(!1,c),e[99]=c,e[100]=_e):_e=e[100];let me;e[101]!==m?(me=Ct(m),e[101]=m,e[102]=me):me=e[102];let se;e[103]!==me?(se=n.jsx(dn,{className:kt,strokeWidth:3,"aria-hidden":"true",style:me}),e[103]=me,e[104]=se):se=e[104];let ce;e[105]!==w||e[106]!==z||e[107]!==Ce||e[108]!==Te||e[109]!==_e||e[110]!==se?(ce=n.jsx(ve,{variant:"outline",onClick:w,"aria-label":z,title:Ce,style:Te,className:_e,children:se}),e[105]=w,e[106]=z,e[107]=Ce,e[108]=Te,e[109]=_e,e[110]=se,e[111]=ce):ce=e[111];let ge;e[112]!==v?(ge=v("accessibility.seekToEnd"),e[112]=v,e[113]=ge):ge=e[113];let ye;e[114]!==v?(ye=v("accessibility.seekToEnd"),e[114]=v,e[115]=ye):ye=e[115];const Ee=`${ye} (F)`;let xe;e[116]!==f?(xe=f(),e[116]=f,e[117]=xe):xe=e[117];let V;e[118]!==c?(V=Ft(!1,c),e[118]=c,e[119]=V):V=e[119];let re;e[120]!==m?(re=Ct(m),e[120]=m,e[121]=re):re=e[121];let Q;e[122]!==re?(Q=n.jsx(fn,{className:kt,strokeWidth:3,"aria-hidden":"true",style:re}),e[122]=re,e[123]=Q):Q=e[123];let Ne;e[124]!==N||e[125]!==ge||e[126]!==Ee||e[127]!==xe||e[128]!==V||e[129]!==Q?(Ne=n.jsx(ve,{variant:"outline",onClick:N,"aria-label":ge,title:Ee,style:xe,className:V,children:Q}),e[124]=N,e[125]=ge,e[126]=Ee,e[127]=xe,e[128]=V,e[129]=Q,e[130]=Ne):Ne=e[130];let Ve;e[131]!==f||e[132]!==c||e[133]!==m||e[134]!==h||e[135]!==g||e[136]!==j||e[137]!==I||e[138]!==x?(Ve=x&&g&&j&&n.jsx(Kn,{trackState:x,onSelectAudio:g,onSelectSubtitle:j,strategy:I,disabled:h,getButtonStyle:f,iconColor:m,hasColors:c}),e[131]=f,e[132]=c,e[133]=m,e[134]=h,e[135]=g,e[136]=j,e[137]=I,e[138]=x,e[139]=Ve):Ve=e[139];let Me;e[140]!==E||e[141]!==oe||e[142]!==ce||e[143]!==Ne||e[144]!==Ve||e[145]!==U?(Me=n.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[U,E,oe,ce,Ne,Ve]}),e[140]=E,e[141]=oe,e[142]=ce,e[143]=Ne,e[144]=Ve,e[145]=U,e[146]=Me):Me=e[146];let st;e[147]===Symbol.for("react.memo_cache_sentinel")?(st=n.jsx("div",{className:"flex-1"}),e[147]=st):st=e[147];let Ue;e[148]!==f||e[149]!==c||e[150]!==m||e[151]!==A||e[152]!==F||e[153]!==v?(Ue=F&&n.jsx(ve,{variant:"outline",onClick:F,"aria-label":A?v("player.exitFullscreen","Exit fullscreen"):v("player.fullscreen","Fullscreen"),style:f(),className:Ft(!1,c),children:A?n.jsx(an,{className:kt,strokeWidth:2.5,"aria-hidden":"true",style:Ct(m)}):n.jsx(ln,{className:kt,strokeWidth:2.5,"aria-hidden":"true",style:Ct(m)})}),e[148]=f,e[149]=c,e[150]=m,e[151]=A,e[152]=F,e[153]=v,e[154]=Ue):Ue=e[154];let Be;e[155]!==v?(Be=v("accessibility.keyboardShortcuts"),e[155]=v,e[156]=Be):Be=e[156];let Oe;e[157]!==f?(Oe=f(),e[157]=f,e[158]=Oe):Oe=e[158];let rt;e[159]!==c?(rt=Ft(!1,c),e[159]=c,e[160]=rt):rt=e[160];let Le;e[161]!==Be||e[162]!==Oe||e[163]!==rt?(Le=n.jsx(ve,{variant:"outline","aria-label":Be,style:Oe,className:rt}),e[161]=Be,e[162]=Oe,e[163]=rt,e[164]=Le):Le=e[164];let ke;e[165]!==m?(ke=Ct(m),e[165]=m,e[166]=ke):ke=e[166];let Fe;e[167]!==ke?(Fe=n.jsx(mn,{className:kt,strokeWidth:3,"aria-hidden":"true",style:ke}),e[167]=ke,e[168]=Fe):Fe=e[168];let Pe;e[169]!==Le||e[170]!==Fe?(Pe=n.jsx(Ss,{render:Le,children:Fe}),e[169]=Le,e[170]=Fe,e[171]=Pe):Pe=e[171];let Ke;e[172]===Symbol.for("react.memo_cache_sentinel")?(Ke=n.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-2 uppercase tracking-wide",id:"skip-duration-label",children:"Skip Duration"}),e[172]=Ke):Ke=e[172];let Re;e[173]!==b||e[174]!==o?(Re=Gn.map((be,at)=>n.jsxs("button",{onClick:()=>b(at),className:H("px-3 py-1.5 rounded-md text-sm font-medium transition-colors",at===o?"bg-primary text-primary-foreground":"bg-muted hover:bg-muted/80 text-foreground"),role:"radio","aria-checked":at===o,"aria-label":`Skip ${be} seconds`,children:[be,"s"]},be)),e[173]=b,e[174]=o,e[175]=Re):Re=e[175];let Ge;e[176]!==Re?(Ge=n.jsxs("div",{className:"mb-4 pb-4 border-b border-border",children:[Ke,n.jsx("div",{className:"flex flex-wrap gap-1.5",role:"radiogroup","aria-labelledby":"skip-duration-label",children:Re})]}),e[176]=Re,e[177]=Ge):Ge=e[177];let xt;e[178]===Symbol.for("react.memo_cache_sentinel")?(xt=n.jsx("p",{className:"text-xs font-medium text-muted-foreground mb-2 uppercase tracking-wide",children:"Keyboard Shortcuts"}),e[178]=xt):xt=e[178];let ze;e[179]===Symbol.for("react.memo_cache_sentinel")?(ze=n.jsxs("div",{children:[xt,n.jsx("div",{className:"space-y-1.5 text-sm",children:Wn.map(Jn)})]}),e[179]=ze):ze=e[179];let He;e[180]!==Ge?(He=n.jsxs(Ts,{align:"end",className:"p-4 min-w-[280px]",children:[Ge,ze]}),e[180]=Ge,e[181]=He):He=e[181];let We;e[182]!==Pe||e[183]!==He?(We=n.jsxs(ks,{children:[Pe,He]}),e[182]=Pe,e[183]=He,e[184]=We):We=e[184];let nt;return e[185]!==y||e[186]!==Me||e[187]!==Ue||e[188]!==We?(nt=n.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-wrap",role:"toolbar","aria-label":y,children:[Me,st,Ue,We]}),e[185]=y,e[186]=Me,e[187]=Ue,e[188]=We,e[189]=nt):nt=e[189],nt});function qn(s){return n.jsx("kbd",{className:"px-2 py-0.5 bg-muted rounded text-xs font-mono ml-1",children:s},s)}function Jn(s){const{label:t,keys:e}=s;return n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-muted-foreground",children:t}),n.jsx("span",{children:e.map(qn)})]},t)}const{SKIP_TIMES:Qn,DEFAULT_SKIP_TIME_INDEX:Xn}=ys,Zn={isPlaying:!1,currentTime:0,duration:0,buffered:0,volume:1,isMuted:!1,skipTimeIndex:Xn,playerError:null,isRecovering:!1,subtitleOffset:0};function ea(s,t){switch(t.type){case"PLAYBACK_UPDATE":return s.currentTime===t.currentTime?s:{...s,currentTime:t.currentTime};case"MEDIA_LOADED":return s.duration===t.duration?s:{...s,duration:t.duration};case"BUFFER_UPDATE":return s.buffered===t.buffered?s:{...s,buffered:t.buffered};case"PLAY_STATE":return s.isPlaying===t.isPlaying?s:{...s,isPlaying:t.isPlaying};case"VOLUME_CHANGE":return s.volume===t.volume&&s.isMuted===t.isMuted?s:{...s,volume:t.volume,isMuted:t.isMuted};case"SKIP_TIME_CHANGE":return s.skipTimeIndex===t.skipTimeIndex?s:{...s,skipTimeIndex:t.skipTimeIndex};case"ERROR_STATE":return{...s,playerError:t.error,isRecovering:t.isRecovering};case"RECOVERY_START":return{...s,isRecovering:!0};case"CYCLE_SKIP":{const e=Math.max(0,Math.min(Qn.length-1,s.skipTimeIndex+t.direction));return e===s.skipTimeIndex?s:{...s,skipTimeIndex:e}}case"SUBTITLE_OFFSET_CHANGE":return s.subtitleOffset===t.offset?s:{...s,subtitleOffset:t.offset}}}const rr={english:"en",german:"de",french:"fr",spanish:"es",italian:"it",portuguese:"pt",russian:"ru",japanese:"ja",chinese:"zh",korean:"ko",dutch:"nl",polish:"pl",swedish:"sv",norwegian:"no",danish:"da",finnish:"fi",arabic:"ar",hebrew:"he",hindi:"hi",thai:"th",vietnamese:"vi",indonesian:"id",turkish:"tr",greek:"el",czech:"cs",hungarian:"hu",romanian:"ro",ukrainian:"uk",deutsch:"de",français:"fr",español:"es",italiano:"it",português:"pt",русский:"ru",日本語:"ja",中文:"zh",한국어:"ko",nederlands:"nl",polski:"pl",svenska:"sv",norsk:"no",dansk:"da",suomi:"fi",العربية:"ar",עברית:"he",हिन्दी:"hi",ไทย:"th",tiếng_việt:"vi",türkçe:"tr",ελληνικά:"el",čeština:"cs",magyar:"hu",română:"ro",українська:"uk"},nr={eng:"en",deu:"de",ger:"de",fra:"fr",fre:"fr",spa:"es",ita:"it",por:"pt",rus:"ru",jpn:"ja",zho:"zh",chi:"zh",kor:"ko",nld:"nl",dut:"nl",pol:"pl",swe:"sv",nor:"no",dan:"da",fin:"fi",ara:"ar",heb:"he",hin:"hi",tha:"th",vie:"vi",ind:"id",tur:"tr",ell:"el",gre:"el",ces:"cs",cze:"cs",hun:"hu",ron:"ro",rum:"ro",ukr:"uk",und:"und"};function ar(s){if(!s)return null;const t=s.toLowerCase().trim();if(!t)return null;if(rr[t])return rr[t];if(nr[t])return nr[t];const e=t.indexOf("-");return e>0?t.slice(0,e):t.slice(0,2)}function Ys(s,t){const e=ar(s),r=ar(t);return!e||!r?!1:e===r}const ta={currentTime:0,volume:1,muted:!1,paused:!0};function lr(s){return s?{currentTime:s.currentTime,volume:s.volume,muted:s.muted,paused:s.paused}:{...ta}}function ir(s,t){s&&(s.volume=t.volume,s.muted=t.muted,t.currentTime>0&&isFinite(t.currentTime)&&(s.currentTime=t.currentTime))}const{RECOVERY_TIMEOUT_MS:sa}=ys,ra={testBandwidth:!1,enableWorker:!0,lowLatencyMode:!1,startLevel:-1,maxBufferLength:30,maxMaxBufferLength:60,abrEwmaDefaultEstimate:5e5},or=(s,t,e,r)=>({type:s,message:e(t),recoverable:r});function na({videoUrl:s,onError:t,onRecoveryStart:e,onRecoveryEnd:r,t:a}){const l=d.useRef(null),o=d.useRef(null),u=d.useRef(null),c=d.useRef(!0),m=d.useRef({onError:t,onRecoveryStart:e,onRecoveryEnd:r,t:a});m.current={onError:t,onRecoveryStart:e,onRecoveryEnd:r,t:a};const f=d.useCallback(()=>{u.current&&(clearTimeout(u.current),u.current=null)},[]),i=d.useCallback(()=>{f(),o.current&&(o.current.destroy(),o.current=null)},[f]);d.useEffect(()=>{const T=l.current;if(!(!T||!s)){if(c.current=!0,m.current.onError(null),i(),ms.isSupported()){const p=new ms(ra);p.attachMedia(T);const w=(N,b,x)=>{if(!c.current)return;const{onError:g,onRecoveryStart:j,onRecoveryEnd:h,t:I}=m.current;g(or(N,b,I,!0)),j(),x(),f(),u.current=setTimeout(()=>{c.current&&h()},sa)};p.on(ms.Events.ERROR,(N,b)=>{if(!c.current||!b.fatal)return;const{t:x}=m.current;switch(b.type){case ms.ErrorTypes.NETWORK_ERROR:w("network","player.error.network",()=>p.startLoad());break;case ms.ErrorTypes.MEDIA_ERROR:w("media","player.error.media",()=>p.recoverMediaError());break;default:m.current.onError(or("unknown","player.error.unknown",x,!1))}}),p.on(ms.Events.MANIFEST_PARSED,()=>{c.current&&(m.current.onError(null),f(),m.current.onRecoveryEnd())}),p.loadSource(s),o.current=p}else T.canPlayType("application/vnd.apple.mpegurl")&&(T.src=s);return()=>{c.current=!1,i()}}},[s,i,f]);const S=d.useCallback(()=>{m.current.onError(null),o.current?.loadSource(s)},[s]);return{videoRef:l,hlsRef:o,retry:S}}function aa(s){switch(s){case MediaError.MEDIA_ERR_ABORTED:return"unknown_error";case MediaError.MEDIA_ERR_NETWORK:return"network_error";case MediaError.MEDIA_ERR_DECODE:case MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED:return"media_error";default:return"unknown_error"}}function la(s,t){const e=aa(s.code);return{type:e,message:t(e==="network_error"?"player.error.network":e==="media_error"?"player.error.directPlayFailed":"player.error.unknown"),recoverable:e==="network_error"||e==="media_error"}}function ia({item:s,preferredAudioStreamIndex:t,onError:e,onStrategyChange:r,t:a}){const[l,o]=d.useState("hls"),[u,c]=d.useState(""),[m,f]=d.useState(!0),[i,S]=d.useState(null),T=d.useRef(0),p=d.useRef(null),w=d.useRef(!0),N=d.useRef(null),b=d.useRef(null),x=d.useRef("hls"),g=d.useCallback(y=>{x.current=y,o(y)},[]),j=d.useRef({onError:e,onStrategyChange:r,t:a});j.current={onError:e,onStrategyChange:r,t:a};const h=na({videoUrl:l==="hls"?u:"",onError:y=>{if(y&&w.current){const C={type:y.type==="network"?"network_error":"media_error",message:y.message,recoverable:y.recoverable};S(C),j.current.onError?.(C)}else S(null)},onRecoveryStart:()=>{},onRecoveryEnd:()=>{},t:a}),I=d.useCallback(async()=>{if(!s?.Id||!w.current)return;N.current&&(p.current=lr(N.current)),await $s(s.Id);const y=await sr(s),C=y.strategy==="hls"?y.url:"";w.current&&(g("hls"),c(C||y.url),j.current.onStrategyChange?.("hls"))},[s]),A=d.useCallback(async y=>{if(!w.current||l!=="direct")return;const C=y.target,M=C.error;if(!M)return;const $=la(M,j.current.t);if($.type==="media_error"){S($),j.current.onError?.($),await I();return}if($.type==="network_error"){if(T.current<1){T.current++,C.load();return}S($),j.current.onError?.($),await I();return}S($),j.current.onError?.($),await I()},[l,I]);d.useEffect(()=>{if(!s?.Id){f(!1),c("");return}return w.current=!0,f(!0),S(null),T.current=0,(async()=>{try{const C=await sr(s,void 0,t);if(!w.current)return;C.strategy==="hls"&&await $s(s.Id),g(C.strategy),c(C.url),f(!1),j.current.onStrategyChange?.(C.strategy)}catch(C){if(!w.current)return;const M={type:"unknown_error",message:j.current.t("player.error.unknown"),recoverable:!1,originalError:C instanceof Error?C:void 0};S(M),f(!1),j.current.onError?.(M)}})(),()=>{w.current=!1;const C=x.current==="hls"?h.videoRef.current:N.current;En(jn(C))}},[s,t,h.videoRef]),d.useEffect(()=>{if(l!=="direct"||!u)return;const y=N.current;if(y){if(y.addEventListener("error",A),y.src=u,p.current){const C=()=>{p.current&&(ir(y,p.current),p.current=null),y.removeEventListener("canplay",C)};y.addEventListener("canplay",C)}return()=>{y.removeEventListener("error",A)}}},[l,u,A]),d.useEffect(()=>{if(l!=="hls"||!h.videoRef.current||!u)return;const y=h.videoRef.current;if(p.current){const C=()=>{p.current&&(ir(y,p.current),p.current=null),y.removeEventListener("canplay",C)};return y.addEventListener("canplay",C),()=>{y.removeEventListener("canplay",C)}}},[l,h.videoRef,u]);const F=d.useCallback(()=>{S(null),T.current=0,l==="hls"?h.retry():N.current&&N.current.load()},[l,h]),v=d.useCallback(async y=>{const C=x.current==="hls"?h.videoRef.current:N.current;C&&(p.current=lr(C)),x.current==="direct"&&(N.current&&(N.current.pause(),N.current.src=""),s?.Id&&await $s(s.Id),g("hls"),j.current.onStrategyChange?.("hls")),c(y)},[s?.Id,h.videoRef,g]),D=l==="hls"?h.videoRef:N,G=l==="hls"?h.hlsRef:b;return{videoRef:D,hlsRef:G,strategy:l,isLoading:m,error:i,retry:F,videoUrl:u,reloadHlsWithUrl:v}}const oa={srt:"SRT",subrip:"SRT",ass:"ASS",ssa:"SSA",pgs:"PGS",pgssub:"PGS",hdmv_pgs_subtitle:"PGS",vobsub:"VobSub",dvdsub:"DVD",dvd_subtitle:"DVD",webvtt:"WebVTT",vtt:"WebVTT",mov_text:"MOV",text:"Text"},ca={1:"Mono",2:"Stereo",6:"5.1",8:"7.1"},ua="Audio",da="Subtitle";function Tr(s){const t={audioTracks:[],subtitleTracks:[]};if(!s?.MediaSources?.length)return t;const r=s.MediaSources[0].MediaStreams??[],a=[],l=[];let o=0,u=0;for(const c of r)c.Type===ua?(a.push(fa(c,o)),o++):c.Type===da&&(l.push(ma(c,u)),u++);return{audioTracks:a,subtitleTracks:l}}function fa(s,t){const e=s.Language??null,r=s.Codec?.toUpperCase()??"Unknown",a=s.Channels??2;return{index:s.Index??0,relativeIndex:t,language:e,displayTitle:s.DisplayTitle??ga({language:e,codec:r,channels:a}),codec:r,channels:a,isDefault:s.IsDefault??!1}}function ma(s,t){const e=s.Language??null,r=s.Codec?.toLowerCase()??"",a=oa[r]??(r.toUpperCase()||"Unknown");return{index:s.Index??0,relativeIndex:t,language:e,displayTitle:s.DisplayTitle??pa({language:e,format:a}),format:a,isExternal:s.IsExternal??!1,isDefault:s.IsDefault??!1,deliveryUrl:s.DeliveryUrl}}function ga(s){const t=kr(s.language),e=ca[s.channels]??`${s.channels}ch`;return`${t} - ${s.codec} ${e}`}function pa(s){return`${kr(s.language)} - ${s.format}`}const cr={eng:"English",en:"English",deu:"German",de:"German",ger:"German",fra:"French",fr:"French",fre:"French",spa:"Spanish",es:"Spanish",ita:"Italian",it:"Italian",jpn:"Japanese",ja:"Japanese",kor:"Korean",ko:"Korean",zho:"Chinese",zh:"Chinese",chi:"Chinese",por:"Portuguese",pt:"Portuguese",rus:"Russian",ru:"Russian",ara:"Arabic",ar:"Arabic",hin:"Hindi",hi:"Hindi",nld:"Dutch",nl:"Dutch",dut:"Dutch",pol:"Polish",pl:"Polish",swe:"Swedish",sv:"Swedish",nor:"Norwegian",no:"Norwegian",dan:"Danish",da:"Danish",fin:"Finnish",fi:"Finnish",tur:"Turkish",tr:"Turkish",tha:"Thai",th:"Thai",vie:"Vietnamese",vi:"Vietnamese",ind:"Indonesian",id:"Indonesian",ces:"Czech",cs:"Czech",cze:"Czech",hun:"Hungarian",hu:"Hungarian",ron:"Romanian",ro:"Romanian",rum:"Romanian",ell:"Greek",el:"Greek",gre:"Greek",heb:"Hebrew",he:"Hebrew",ukr:"Ukrainian",uk:"Ukrainian",und:"Undetermined"};function kr(s){if(!s)return"Unknown";const t=s.toLowerCase();if(cr[t])return cr[t];try{const r=new Intl.DisplayNames(["en"],{type:"language"}).of(t);if(r&&r!==t)return r}catch{}return"Unknown"}function wr(s){const t=s.format.toLowerCase();return t==="ass"||t==="ssa"}const{TICKS_PER_SECOND:ha}=Rr,{SUPPORTED_FONT_TYPES:ya,JASSUB_READY_TIMEOUT_MS:xa}=Pr;function ba(s,t){const{serverAddress:e,accessToken:r}=Ks();if(s.deliveryUrl){const o=s.deliveryUrl.startsWith("/")?s.deliveryUrl.slice(1):s.deliveryUrl;return Vs({serverAddress:e,accessToken:r,endpoint:o})}const a=t.replace(/-/g,""),l=s.format.toLowerCase()==="ssa"?"ssa":"ass";return Vs({serverAddress:e,accessToken:r,endpoint:`Videos/${t}/${a}/Subtitles/${s.index}/Stream.${l}`})}function va(s){const{serverAddress:t}=Ks(),e=s.MediaSources?.[0];if(!e?.MediaAttachments?.length)return[];const r=s.Id??"",a=e.Id??r.replace(/-/g,""),l=t.replace(/\/+$/,"");return e.MediaAttachments.filter(o=>{const u=o.MimeType?.toLowerCase();return u&&ya.some(c=>c.toLowerCase()===u)}).flatMap(o=>o.DeliveryUrl?[`${l}${o.DeliveryUrl}`]:o.Index!=null?[`${l}/Videos/${r}/${a}/Attachments/${o.Index}`]:[])}function ur(s,t){return s/ha+t}async function Sa(s){const{video:t,track:e,item:r,transcodingOffsetTicks:a=0,userOffset:l=0}=s,o=r.Id??"",u=ba(e,o),c=va(r),m=ur(a,l),f=(await Ir(async()=>{const{default:T}=await import("./jassub-BtnWmffD.js");return{default:T}},__vite__mapDeps([0,1]))).default,i=new f({video:t,subUrl:u,fonts:c,timeOffset:m,useLocalFonts:!0,debug:!1});await Promise.race([i.ready,new Promise((T,p)=>setTimeout(()=>p(new Error("JASSUB ready timeout")),xa))]).catch(T=>{throw i.destroy(),T});let S=!1;return{instance:i,destroy:()=>{if(!S){S=!0;try{i.destroy()}catch{}}},setTimeOffset:(T,p)=>{if(!S)try{i.timeOffset=ur(T,p)}catch{}},setTrack:async T=>{if(S)return;const p=await fetch(T);if(!p.ok)throw new Error(`Failed to fetch subtitle: ${p.status}`);const w=await p.text();await i.renderer.setTrack(w)}}}function Ta(s,t,e="vtt"){const r=Ks();if(!r.serverAddress||!r.accessToken)return"";const a=new URLSearchParams({DeviceId:Ar()});return Vs({serverAddress:r.serverAddress,accessToken:r.accessToken,endpoint:`Videos/${s}/${s}/Subtitles/${t}/0/Stream.${e}`,query:a})}function Er(s,t){return Cn({itemId:s},t)}function jr(s,t){return t.find(r=>r.index===s)?.relativeIndex??-1}function ka(s,t,e){if(!t)return{success:!1,error:{type:"api_unsupported",message:"HLS instance not available",trackIndex:s}};if(e&&e.length>0&&!e.find(l=>l.index===s))return{success:!1,error:{type:"track_unavailable",message:`Audio track with MediaStream index ${s} not found in track list`,trackIndex:s}};const r=t.audioTracks;if(r.length>1){let a=-1;if(e&&e.length>0){const l=e.find(o=>o.index===s);if(l?.language){const o=l.language.toLowerCase(),u=r.findIndex(c=>c.lang?.toLowerCase()===o||c.name&&c.name.toLowerCase().includes(o));u!==-1&&(a=u)}if(a===-1){const o=e.findIndex(u=>u.index===s);o!==-1&&o<r.length&&(a=o)}}if(a>=0&&a<r.length)try{return t.audioTrack=a,{success:!0}}catch{}}return{success:!0,reloadRequired:!0}}function wa(s,t){const{videoElement:e,audioTracks:r,itemId:a,onReloadHls:l}=t,u=e.audioTracks,c=r?.find(f=>f.index===s);if(!c)return Promise.resolve({success:!1,error:{type:"track_unavailable",message:`Audio track with index ${s} not found`,trackIndex:s}});if(u&&u.length>1){if(c.relativeIndex>=0&&c.relativeIndex<u.length){for(let i=0;i<u.length;i++)u[i].enabled=i===c.relativeIndex;return Promise.resolve({success:!0})}if(c.language){const i=c.language.toLowerCase();for(let S=0;S<u.length;S++){const p=u[S].language.toLowerCase();if(p===i||p.startsWith(i.slice(0,2))||i.startsWith(p.slice(0,2))){for(let w=0;w<u.length;w++)u[w].enabled=w===S;return Promise.resolve({success:!0})}}}const f=r?.findIndex(i=>i.index===s)??-1;if(f>=0&&f<u.length){for(let i=0;i<u.length;i++)u[i].enabled=i===f;return Promise.resolve({success:!0})}}if(!a)return Promise.resolve({success:!1,error:{type:"api_unsupported",message:"Audio track switching requires transcoding in this browser. Item ID not available.",trackIndex:s}});if(!l)return Promise.resolve({success:!1,error:{type:"api_unsupported",message:"Audio track switching requires transcoding in this browser. Please wait for the stream to reload.",trackIndex:s}});const m=Er(a,s);return m?(l(m),Promise.resolve({success:!0,reloadRequired:!0})):Promise.resolve({success:!1,error:{type:"network_error",message:"Failed to generate HLS URL for audio track switching",trackIndex:s}})}function Ea(s,t,e){if(!t)return{success:!1,error:{type:"api_unsupported",message:"HLS instance not available",trackIndex:s??-1}};try{if(s===null)return t.subtitleTrack=-1,{success:!0};let r;if(e&&e.length>0){if(r=jr(s,e),r===-1)return{success:!1,error:{type:"track_unavailable",message:`Subtitle track with MediaStream index ${s} not found in track list`,trackIndex:s}}}else r=s;const a=t.subtitleTracks;return r<0||r>=a.length?{success:!1,error:{type:"track_unavailable",message:`Subtitle track relative index ${r} is out of range (0-${a.length-1})`,trackIndex:s}}:(t.subtitleTrack=r,{success:!0})}catch(r){return{success:!1,error:{type:"unknown_error",message:r instanceof Error?r.message:"Failed to switch subtitle track",trackIndex:s??-1}}}}async function ja(s,t){const{videoElement:e,itemId:r,subtitleTracks:a}=t,l=e.textTracks;if(s===null)return Array.from(l).forEach(u=>{u.mode="hidden"}),{success:!0};let o;if(a&&a.length>0?o=jr(s,a):o=s,o!==-1&&o>=0&&o<l.length)return Array.from(l).forEach(u=>{u.mode="hidden"}),l[o].mode="showing",{success:!0};if(!r)return{success:!1,error:{type:"track_unavailable",message:"Subtitle track not available and no item ID for external fetch",trackIndex:s}};try{const u=Ta(r,s,"vtt");if(!u)return{success:!1,error:{type:"network_error",message:"Failed to generate subtitle URL",trackIndex:s}};const c=document.createElement("track");c.kind="subtitles",c.src=u,c.default=!0,Array.from(l).forEach(f=>{f.mode="hidden"}),e.appendChild(c),await new Promise((f,i)=>{c.addEventListener("load",()=>f()),c.addEventListener("error",()=>i(new Error("Failed to load subtitle"))),setTimeout(()=>i(new Error("Subtitle load timeout")),1e4)});const m=l.length-1;return m>=0&&(l[m].mode="showing"),{success:!0}}catch(u){return{success:!1,error:{type:"network_error",message:u instanceof Error?u.message:"Failed to load external subtitle",trackIndex:s}}}}async function Ca(s,t){if(t.strategy==="hls"){const e=ka(s,t.hlsInstance,t.audioTracks);if(e.success&&e.reloadRequired){if(!t.itemId)return{success:!1,error:{type:"api_unsupported",message:"Item ID required for HLS audio track switching",trackIndex:s}};if(!t.onReloadHls)return{success:!1,error:{type:"api_unsupported",message:"HLS reload callback not provided",trackIndex:s}};const r=Er(t.itemId,s);return r?(t.onReloadHls(r),{success:!0,reloadRequired:!0}):{success:!1,error:{type:"network_error",message:"Failed to generate HLS URL with audio track",trackIndex:s}}}return e}return wa(s,t)}async function _a(s,t){if(s===null){const r=t.videoElement.textTracks;return Array.from(r).forEach(a=>{a.mode="hidden"}),t.strategy==="hls"&&t.hlsInstance&&(t.hlsInstance.subtitleTrack=-1),{success:!0,jassubAction:"dispose"}}const e=t.subtitleTracks?.find(r=>r.index===s);if(!e)return{success:!1,error:{type:"track_unavailable",message:`Subtitle track with index ${s} not found`,trackIndex:s}};if(wr(e)){const r=t.videoElement.textTracks;return Array.from(r).forEach(a=>{a.mode="hidden"}),t.strategy==="hls"&&t.hlsInstance&&(t.hlsInstance.subtitleTrack=-1),{success:!0,jassubAction:"initialize",track:e}}return t.strategy==="hls"?Ea(s,t.hlsInstance,t.subtitleTracks):ja(s,t)}const Us={audioTracks:[],subtitleTracks:[],activeAudioIndex:0,activeSubtitleIndex:null};function Na(s,t){if(t){const r=s.find(a=>Ys(a.language,t));if(r)return r.index}const e=s.find(r=>r.isDefault);return e?e.index:s.length>0?s[0].index:0}function Ia(s,t,e){if(!e)return null;if(t){const a=s.find(l=>Ys(l.language,t));if(a)return a.index}const r=s.find(a=>a.isDefault);return r?r.index:null}function Pa({item:s,strategy:t,videoRef:e,hlsRef:r,t:a,onReloadHls:l}){const[o,u]=d.useState(Us),[c,m]=d.useState(!1),[f,i]=d.useState(null),S=gs(x=>x.trackPreferences),T=d.useRef(s),p=d.useRef(S);if(s!==T.current||S!==p.current)if(T.current=s,p.current=S,!s)o!==Us&&(u(Us),i(null));else{const{audioTracks:x,subtitleTracks:g}=Tr(s),j=Na(x,S.preferredAudioLanguage),h=Ia(g,S.preferredSubtitleLanguage,S.subtitlesEnabled);u({audioTracks:x,subtitleTracks:g,activeAudioIndex:j,activeSubtitleIndex:h}),i(null)}const w=d.useMemo(()=>({strategy:t,videoElement:e.current,hlsInstance:r?.current,itemId:s?.Id,mediaSourceId:s?.MediaSources?.[0]?.Id??void 0,audioTracks:o.audioTracks,subtitleTracks:o.subtitleTracks,onReloadHls:l}),[t,e,r,s?.Id,s?.MediaSources,o.audioTracks,o.subtitleTracks,l]),N=d.useCallback(async x=>{const g=e.current;if(!g){i(a("player.tracks.error.noVideo"));return}if(!o.audioTracks.find(h=>h.index===x)){const h=a("player.tracks.error.trackNotFound");i(h),_t(h);return}if(x!==o.activeAudioIndex){m(!0),i(null);try{const h=await Ca(x,{...w,videoElement:g,hlsInstance:r?.current});if(h.success)u(I=>({...I,activeAudioIndex:x}));else if(h.error){const I=h.error.message||a("player.tracks.error.switchFailed");i(I),_t(I)}}catch(h){const I=h instanceof Error?h.message:a("player.tracks.error.switchFailed");i(I),_t(I)}finally{m(!1)}}},[e,r,o.audioTracks,o.activeAudioIndex,w,a]),b=d.useCallback(async x=>{const g=e.current;if(!g){i(a("player.tracks.error.noVideo"));return}if(x!==null&&!o.subtitleTracks.find(h=>h.index===x)){const h=a("player.tracks.error.trackNotFound");i(h),_t(h);return}if(x!==o.activeSubtitleIndex){m(!0),i(null);try{const j=await _a(x,{...w,videoElement:g,hlsInstance:r?.current});if(j.success)u(h=>({...h,activeSubtitleIndex:x}));else if(j.error){const h=j.error.message||a("player.tracks.error.switchFailed");i(h),_t(h)}}catch(j){const h=j instanceof Error?j.message:a("player.tracks.error.switchFailed");i(h),_t(h)}finally{m(!1)}}},[e,r,o.subtitleTracks,o.activeSubtitleIndex,w,a]);return{trackState:o,selectAudioTrack:N,selectSubtitleTrack:b,isLoading:c,error:f}}const Ra=15e3;function Aa(s){return s.readyState>=1&&s.videoWidth>0?Promise.resolve():new Promise((t,e)=>{const r=setTimeout(()=>{a(),e(new Error("Timeout waiting for video metadata"))},Ra),a=()=>{clearTimeout(r),s.removeEventListener("loadedmetadata",l),s.removeEventListener("error",o)},l=()=>{a(),t()},o=()=>{a(),e(new Error("Video error"))};s.addEventListener("loadedmetadata",l),s.addEventListener("error",o)})}function Da(s,t){const e=s instanceof Error?s.message.toLowerCase():"";return e.includes("timeout")?t("player.subtitle.error.timeout"):e.includes("wasm")||e.includes("worker")?t("player.subtitle.error.wasmFailed"):e.includes("fetch")||e.includes("network")?t("player.subtitle.error.loadFailed"):t("player.subtitle.error.jassubInit")}function Ma({videoRef:s,activeTrack:t,item:e,transcodingOffsetTicks:r,userOffset:a,t:l}){const[o,u]=d.useState(!1),[c,m]=d.useState(!1),[f,i]=d.useState(null),S=d.useRef(null),T=d.useRef(a),p=d.useRef(r),w=d.useRef(null),N=d.useRef(t),b=d.useRef(e?.Id);T.current=a,p.current=r;const x=d.useCallback(()=>{S.current?.destroy(),S.current=null,u(!1)},[]),g=d.useCallback(()=>{w.current&&clearTimeout(w.current),w.current=setTimeout(()=>{S.current?.instance.resize()},ys.RESIZE_DEBOUNCE_MS)},[]),j=d.useCallback(h=>{T.current=h,S.current?.setTimeOffset(p.current,h)},[]);return d.useEffect(()=>{const h=s.current;if(!(t&&wr(t))||!h||!e?.Id){x(),i(null);return}if(t===N.current&&e.Id===b.current&&S.current)return;N.current=t,b.current=e.Id;let A=!1;return(async()=>{x(),m(!0),i(null);try{if(await Aa(h),A)return;const v=await Sa({video:h,track:t,item:e,transcodingOffsetTicks:r,userOffset:T.current});S.current=v,u(!0)}catch(v){if(A)return;const D=v instanceof Error?v.message:String(v);i(D),_t(Da(v,l),D),console.error("[JASSUB] Init error:",v)}finally{A||m(!1)}})(),()=>{A=!0}},[t,e,s,r,x,l]),d.useEffect(()=>{const h=s.current;if(!h||!o)return;const I=new ResizeObserver(g);I.observe(h);const A=()=>setTimeout(g,150);return document.addEventListener("fullscreenchange",A),()=>{I.disconnect(),document.removeEventListener("fullscreenchange",A),w.current&&clearTimeout(w.current)}},[s,o,g]),d.useEffect(()=>()=>{x(),w.current&&clearTimeout(w.current)},[x]),{isActive:o,isLoading:c,error:f,setUserOffset:j,resize:g}}const dr={" ":"togglePlay",w:"cycleSkipTimeUp",s:"cycleSkipTimeDown",a:"skipBackward",d:"skipForward",e:"pushStartTimestamp",f:"pushEndTimestamp",m:"toggleMute"};function La(s){const t=d.useMemo(()=>Object.values(s),[s.togglePlay,s.cycleSkipTimeUp,s.cycleSkipTimeDown,s.skipBackward,s.skipForward,s.pushStartTimestamp,s.pushEndTimestamp,s.toggleMute]);d.useEffect(()=>{const e=new AbortController,r=a=>{if(Fn(a.target))return;const l=a.key.toLowerCase();l in dr&&(a.preventDefault(),s[dr[l]]())};return window.addEventListener("keydown",r,{signal:e.signal}),()=>e.abort()},[t,s])}const{SKIP_TIMES:fr}=ys,Fa=s=>({vibrantColors:s.vibrantColors,persistedVolume:s.playerVolume,persistedMuted:s.playerMuted,setPlayerVolume:s.setPlayerVolume,setPlayerMuted:s.setPlayerMuted});function za(s,t){if(!t)return;const{audioTracks:e}=Tr(s);return e.length===0?void 0:e.find(a=>Ys(a.language,t))?.index}function $a(s){const t=je.c(162),{item:e,timestamp:r,onCreateSegment:a,onUpdateSegmentTimestamp:l,className:o}=s,{t:u}=ps(),{vibrantColors:c,persistedVolume:m,persistedMuted:f,setPlayerVolume:i,setPlayerMuted:S}=Lt(Dr(Fa)),{getButtonStyle:T,iconColor:p,hasColors:w}=Sr(c);let N;t[0]!==f||t[1]!==m?(N={...Zn,volume:m,isMuted:f},t[0]=f,t[1]=m,t[2]=N):N=t[2];const[b,x]=d.useReducer(ea,N),{isPlaying:g,currentTime:j,duration:h,buffered:I,volume:A,isMuted:F,skipTimeIndex:v,playerError:D,isRecovering:G,subtitleOffset:y}=b,C=d.useRef(j),M=d.useRef(h),$=d.useRef(null),B=d.useRef(null),[U,X]=d.useState(!1);let W,Y;t[3]!==j||t[4]!==h?(W=()=>{C.current=j,M.current=h},Y=[j,h],t[3]=j,t[4]=h,t[5]=W,t[6]=Y):(W=t[5],Y=t[6]),d.useLayoutEffect(W,Y);let L;t[7]!==e?(L=vr(e,900,506)??null,t[7]=e,t[8]=L):L=t[8];const q=_n(L),_=Ba;let P;t[9]===Symbol.for("react.memo_cache_sentinel")?(P=k=>{if(k){const J={type:_(k.type),message:k.message,recoverable:k.recoverable};x({type:"ERROR_STATE",error:J,isRecovering:!1})}else x({type:"ERROR_STATE",error:null,isRecovering:!1})},t[9]=P):P=t[9];const O=P;let R;t[10]!==u?(R=k=>{$.current==="direct"&&k==="hls"&&zt({type:"info",message:u("player.notification.switchedToTranscode"),duration:3e3}),$.current=k},t[10]=u,t[11]=R):R=t[11];const K=R,ae=gs(Ha);let te;t[12]!==e||t[13]!==ae?(te=za(e,ae),t[12]=e,t[13]=ae,t[14]=te):te=t[14];const ue=te;let le;t[15]!==K||t[16]!==e||t[17]!==ue||t[18]!==u?(le={item:e,preferredAudioStreamIndex:ue,onError:O,onStrategyChange:K,t:u},t[15]=K,t[16]=e,t[17]=ue,t[18]=u,t[19]=le):le=t[19];const{videoRef:E,hlsRef:pe,strategy:ee,isLoading:Se,error:ie,retry:he,reloadHlsWithUrl:de}=ia(le),ne=gs(Va),we=gs(Oa),fe=gs(Ua);let oe;t[20]!==pe||t[21]!==e||t[22]!==de||t[23]!==ee||t[24]!==u||t[25]!==E?(oe={item:e,strategy:ee,videoRef:E,hlsRef:pe,t:u,onReloadHls:de},t[20]=pe,t[21]=e,t[22]=de,t[23]=ee,t[24]=u,t[25]=E,t[26]=oe):oe=t[26];const{trackState:z,selectAudioTrack:Ie,selectSubtitleTrack:Ce,isLoading:Te}=Pa(oe);let _e;e:{if(z.activeSubtitleIndex===null){_e=null;break e}let k;t[27]!==z.activeSubtitleIndex||t[28]!==z.subtitleTracks?(k=z.subtitleTracks.find(J=>J.index===z.activeSubtitleIndex)??null,t[27]=z.activeSubtitleIndex,t[28]=z.subtitleTracks,t[29]=k):k=t[29],_e=k}const me=_e;let se;t[30]!==me||t[31]!==e||t[32]!==y||t[33]!==u||t[34]!==E?(se={videoRef:E,activeTrack:me,item:e,transcodingOffsetTicks:0,userOffset:y,t:u},t[30]=me,t[31]=e,t[32]=y,t[33]=u,t[34]=E,t[35]=se):se=t[35],Ma(se);let ce,ge;t[36]!==ie?(ce=()=>{ie&&x({type:"ERROR_STATE",error:{type:_(ie.type),message:ie.message,recoverable:ie.recoverable},isRecovering:!1})},ge=[ie,_],t[36]=ie,t[37]=ce,t[38]=ge):(ce=t[37],ge=t[38]),d.useEffect(ce,ge);let ye,Ee;t[39]!==r||t[40]!==E?(ye=()=>{r!==void 0&&E.current&&(E.current.currentTime=r)},Ee=[r,E],t[39]=r,t[40]=E,t[41]=ye,t[42]=Ee):(ye=t[41],Ee=t[42]),d.useEffect(ye,Ee);let xe,V;t[43]!==f||t[44]!==m||t[45]!==E?(xe=()=>{const k=E.current;k&&(k.volume=m,k.muted=f)},V=[E,m,f],t[43]=f,t[44]=m,t[45]=E,t[46]=xe,t[47]=V):(xe=t[46],V=t[47]),d.useEffect(xe,V);let re;t[48]!==E?(re=()=>{E.current&&x({type:"PLAYBACK_UPDATE",currentTime:E.current.currentTime})},t[48]=E,t[49]=re):re=t[49];const Q=re;let Ne;t[50]!==E?(Ne=()=>{E.current&&x({type:"MEDIA_LOADED",duration:E.current.duration})},t[50]=E,t[51]=Ne):Ne=t[51];const Ve=Ne;let Me;t[52]!==E?(Me=()=>{const k=E.current;k?.buffered.length&&x({type:"BUFFER_UPDATE",buffered:k.buffered.end(k.buffered.length-1)})},t[52]=E,t[53]=Me):Me=t[53];const st=Me;let Ue;t[54]===Symbol.for("react.memo_cache_sentinel")?(Ue=()=>{x({type:"PLAY_STATE",isPlaying:!0})},t[54]=Ue):Ue=t[54];const Be=Ue;let Oe;t[55]===Symbol.for("react.memo_cache_sentinel")?(Oe=()=>{x({type:"PLAY_STATE",isPlaying:!1})},t[55]=Oe):Oe=t[55];const rt=Oe;let Le;t[56]!==E?(Le=()=>{const k=E.current;k&&(k.paused?k.play():k.pause())},t[56]=E,t[57]=Le):Le=t[57];const ke=Le;let Fe;t[58]!==S||t[59]!==b.volume||t[60]!==E?(Fe=()=>{const k=E.current;k&&(k.muted=!k.muted,x({type:"VOLUME_CHANGE",volume:b.volume,isMuted:k.muted}),S(k.muted))},t[58]=S,t[59]=b.volume,t[60]=E,t[61]=Fe):Fe=t[61];const Pe=Fe;let Ke;t[62]!==S||t[63]!==i||t[64]!==E?(Ke=k=>{const J=E.current;if(!J)return;J.volume=k;const tt=k>0&&J.muted,jt=k===0?!0:tt?!1:J.muted;tt&&(J.muted=!1),x({type:"VOLUME_CHANGE",volume:k,isMuted:jt}),i(k),S(jt)},t[62]=S,t[63]=i,t[64]=E,t[65]=Ke):Ke=t[65];const Re=Ke;let Ge;t[66]!==E?(Ge=k=>{E.current&&(E.current.currentTime=k,x({type:"PLAYBACK_UPDATE",currentTime:k}))},t[66]=E,t[67]=Ge):Ge=t[67];const xt=Ge;let ze;t[68]!==v||t[69]!==E?(ze=()=>{const k=E.current;if(!k)return;const J=Math.min(C.current+fr[v],M.current);k.currentTime=J,x({type:"PLAYBACK_UPDATE",currentTime:J})},t[68]=v,t[69]=E,t[70]=ze):ze=t[70];const He=ze;let We;t[71]!==v||t[72]!==E?(We=()=>{const k=E.current;if(!k)return;const J=Math.max(C.current-fr[v],0);k.currentTime=J,x({type:"PLAYBACK_UPDATE",currentTime:J})},t[71]=v,t[72]=E,t[73]=We):We=t[73];const nt=We;let be;t[74]===Symbol.for("react.memo_cache_sentinel")?(be=()=>{x({type:"CYCLE_SKIP",direction:1})},t[74]=be):be=t[74];const at=be;let lt;t[75]===Symbol.for("react.memo_cache_sentinel")?(lt=()=>{x({type:"CYCLE_SKIP",direction:-1})},t[75]=lt):lt=t[75];const Nt=lt;let it;t[76]!==l?(it=()=>{l({currentTime:C.current,start:!0})},t[76]=l,t[77]=it):it=t[77];const Ye=it;let ot;t[78]!==l?(ot=()=>{l({currentTime:C.current,start:!1})},t[78]=l,t[79]=ot):ot=t[79];const qe=ot;let ct;t[80]!==a?(ct=k=>{a({type:k,start:C.current})},t[80]=a,t[81]=ct):ct=t[81];const It=ct;let ut;t[82]!==qe||t[83]!==Ye||t[84]!==nt||t[85]!==He||t[86]!==Pe||t[87]!==ke?(ut={togglePlay:ke,cycleSkipTimeUp:at,cycleSkipTimeDown:Nt,skipBackward:nt,skipForward:He,pushStartTimestamp:Ye,pushEndTimestamp:qe,toggleMute:Pe},t[82]=qe,t[83]=Ye,t[84]=nt,t[85]=He,t[86]=Pe,t[87]=ke,t[88]=ut):ut=t[88],La(ut);let dt;t[89]===Symbol.for("react.memo_cache_sentinel")?(dt=()=>{const k=B.current;k&&(document.fullscreenElement?document.exitFullscreen():k.requestFullscreen())},t[89]=dt):dt=t[89];const Pt=dt;let wt,ft;t[90]===Symbol.for("react.memo_cache_sentinel")?(wt=()=>{const k=()=>{X(!!document.fullscreenElement)};return document.addEventListener("fullscreenchange",k),()=>{document.removeEventListener("fullscreenchange",k)}},ft=[],t[90]=wt,t[91]=ft):(wt=t[90],ft=t[91]),d.useEffect(wt,ft);let Rt;t[92]===Symbol.for("react.memo_cache_sentinel")?(Rt=k=>{x({type:"SKIP_TIME_CHANGE",skipTimeIndex:k})},t[92]=Rt):Rt=t[92];const hs=Rt;let mt;t[93]!==Ie||t[94]!==ne||t[95]!==z.audioTracks?(mt=async k=>{await Ie(k);const J=z.audioTracks.find(tt=>tt.index===k);J?.language&&ne(J.language)},t[93]=Ie,t[94]=ne,t[95]=z.audioTracks,t[96]=mt):mt=t[96];const bt=mt;let gt;t[97]!==Ce||t[98]!==we||t[99]!==fe||t[100]!==z.subtitleTracks?(gt=async k=>{if(await Ce(k),k===null)fe(!1);else{fe(!0);const J=z.subtitleTracks.find(tt=>tt.index===k);J?.language&&we(J.language)}},t[97]=Ce,t[98]=we,t[99]=fe,t[100]=z.subtitleTracks,t[101]=gt):gt=t[101];const At=gt,Dt=z.audioTracks.length>0||z.subtitleTracks.length>0;let vt;t[102]!==o?(vt=H("flex flex-col gap-4",o),t[102]=o,t[103]=vt):vt=t[103];let Je;t[104]!==u?(Je=u("player.videoPlayer"),t[104]=u,t[105]=Je):Je=t[105];let Qe;t[106]!==Ve||t[107]!==st||t[108]!==Q||t[109]!==q||t[110]!==Je||t[111]!==E?(Qe=n.jsx("video",{ref:E,className:"w-full h-full object-contain",poster:q,crossOrigin:"anonymous",playsInline:!0,"aria-label":Je,onTimeUpdate:Q,onDurationChange:Ve,onProgress:st,onPlay:Be,onPause:rt}),t[106]=Ve,t[107]=st,t[108]=Q,t[109]=q,t[110]=Je,t[111]=E,t[112]=Qe):Qe=t[112];let pt;t[113]!==he||t[114]!==G||t[115]!==D||t[116]!==ee||t[117]!==u?(pt=D&&!G&&n.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-black/80 text-white",children:[n.jsx(gn,{className:"size-12 text-destructive mb-4"}),n.jsx("p",{className:"text-lg font-medium mb-2",children:D.message}),ee==="direct"&&D.type==="media"&&n.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:u("player.error.directPlayFailed")}),D.recoverable&&n.jsxs(ve,{variant:"outline",size:"sm",onClick:k=>{k.stopPropagation(),he()},className:"mt-2",children:[n.jsx(zs,{className:"size-4 mr-2"}),u("player.retry")]})]}),t[113]=he,t[114]=G,t[115]=D,t[116]=ee,t[117]=u,t[118]=pt):pt=t[118];let Xe;t[119]!==Se||t[120]!==u?(Xe=Se&&n.jsxs("div",{className:"absolute inset-0 flex items-center justify-center bg-black/60",role:"status","aria-live":"polite","aria-busy":"true",children:[n.jsx(zs,{className:"size-8 text-white animate-spin","aria-hidden":"true"}),n.jsx("span",{className:"sr-only",children:u("accessibility.loading")})]}),t[119]=Se,t[120]=u,t[121]=Xe):Xe=t[121];let ht;t[122]!==G||t[123]!==u?(ht=G&&n.jsxs("div",{className:"absolute inset-0 flex items-center justify-center bg-black/60",role:"status","aria-live":"polite","aria-busy":"true",children:[n.jsx(zs,{className:"size-8 text-white animate-spin","aria-hidden":"true"}),n.jsx("span",{className:"sr-only",children:u("player.recovering","Recovering playback")})]}),t[122]=G,t[123]=u,t[124]=ht):ht=t[124];let Ze;t[125]!==Qe||t[126]!==pt||t[127]!==Xe||t[128]!==ht||t[129]!==ke?(Ze=n.jsx("div",{ref:B,className:"relative",children:n.jsxs("div",{className:"relative cursor-pointer aspect-video",onClick:ke,children:[Qe,pt,Xe,ht]})}),t[125]=Qe,t[126]=pt,t[127]=Xe,t[128]=ht,t[129]=ke,t[130]=Ze):Ze=t[130];let St;t[131]!==I||t[132]!==j||t[133]!==h||t[134]!==xt?(St=n.jsx(On,{currentTime:j,duration:h,buffered:I,onSeek:xt}),t[131]=I,t[132]=j,t[133]=h,t[134]=xt,t[135]=St):St=t[135];const Tt=!Dt||Te;let et;t[136]!==T||t[137]!==bt||t[138]!==It||t[139]!==At||t[140]!==Re||t[141]!==w||t[142]!==p||t[143]!==U||t[144]!==F||t[145]!==g||t[146]!==qe||t[147]!==Ye||t[148]!==v||t[149]!==ee||t[150]!==Tt||t[151]!==Pe||t[152]!==ke||t[153]!==z||t[154]!==c||t[155]!==A?(et=n.jsx(Yn,{isPlaying:g,isMuted:F,volume:A,skipTimeIndex:v,vibrantColors:c,hasColors:w,iconColor:p,getButtonStyle:T,onTogglePlay:ke,onToggleMute:Pe,onVolumeChange:Re,onCreateSegment:It,onPushStartTimestamp:Ye,onPushEndTimestamp:qe,onSkipTimeChange:hs,trackState:z,onSelectAudioTrack:bt,onSelectSubtitleTrack:At,isTrackSelectorDisabled:Tt,strategy:ee,isFullscreen:U,onToggleFullscreen:Pt}),t[136]=T,t[137]=bt,t[138]=It,t[139]=At,t[140]=Re,t[141]=w,t[142]=p,t[143]=U,t[144]=F,t[145]=g,t[146]=qe,t[147]=Ye,t[148]=v,t[149]=ee,t[150]=Tt,t[151]=Pe,t[152]=ke,t[153]=z,t[154]=c,t[155]=A,t[156]=et):et=t[156];let Et;return t[157]!==vt||t[158]!==Ze||t[159]!==St||t[160]!==et?(Et=n.jsxs("div",{className:vt,children:[Ze,St,et]}),t[157]=vt,t[158]=Ze,t[159]=St,t[160]=et,t[161]=Et):Et=t[161],Et}function Ua(s){return s.setSubtitlesEnabled}function Oa(s){return s.setPreferredSubtitleLanguage}function Va(s){return s.setPreferredAudioLanguage}function Ha(s){return s.trackPreferences.preferredAudioLanguage}function Ba(s){switch(s){case"media_error":return"media";case"network_error":return"network";default:return"unknown"}}const Ka=s=>t=>{if(Lr(t))return;const e=pr.from(t);Fr(e,{operation:s}),_t(`${s} failed`,e.recoverable?"Please try again":e.message)},Ga=()=>{const s=je.c(1),t=d.useRef(null);let e;return s[0]===Symbol.for("react.memo_cache_sentinel")?(e=()=>(t.current?.abort(),t.current=new AbortController,t.current),s[0]=e):e=s[0],e},Wa=(s,t)=>async e=>{try{return await s(e,t().signal)}catch(r){throw pr.from(r)}},Ya=(s,t,e,r)=>{if(!e)return;s.setQueryData($t.list(t),e);const a=s.getQueryData($t.list(t));(!a||a.length!==e.length||!e.every(l=>a.some(o=>o.Id===l.Id)))&&s.invalidateQueries({queryKey:$t.list(t)}),r.rolledBack=!0},qa=()=>{const s=je.c(12),t=_r(),e=Ga();let r;s[0]!==e?(r=Wa(Ja,e),s[0]=e,s[1]=r):r=s[1];let a,l;s[2]!==t?(a=async c=>{const{itemId:m,newSegments:f}=c;await t.cancelQueries({queryKey:$t.list(m)});const i=t.getQueryData($t.list(m));return t.setQueryData($t.list(m),f),{previousSegments:i,rolledBack:!1}},l=(c,m,f)=>{const{itemId:i}=m;f?.previousSegments&&Ya(t,i,f.previousSegments,f),Ka("Save segments")(c)},s[2]=t,s[3]=a,s[4]=l):(a=s[3],l=s[4]);let o;s[5]!==t?(o=(c,m,f,i)=>{const{itemId:S}=f;i?.rolledBack||t.invalidateQueries({queryKey:$t.list(S)})},s[5]=t,s[6]=o):o=s[6];let u;return s[7]!==r||s[8]!==a||s[9]!==l||s[10]!==o?(u={mutationFn:r,onMutate:a,onError:l,onSuccess:Qa,onSettled:o},s[7]=r,s[8]=a,s[9]=l,s[10]=o,s[11]=u):u=s[11],Nr(u)};function Ja(s,t){const{itemId:e,existingSegments:r,newSegments:a,providerId:l}=s;return zr(e,r,a,l,{signal:t})}function Qa(s,t){const{newSegments:e}=t,r=s.length,a=e.length;r===a?Mr("All segments saved"):r>0&&_t("Partial save",`${r} of ${a} segments saved`)}const{MIN_SEGMENT_GAP:Mt}=mr,Os=14,Xa=s=>s.saveToClipboard,Za=s=>s.vibrantColors,el=d.memo(function(t){const e=je.c(275),{segment:r,index:a,activeIndex:l,runtimeSeconds:o,onUpdate:u,onDelete:c,onPlayerTimestamp:m,onSetActive:f}=t,{t:i}=ps(),S=Lt(Xa),T=Lt(Za),p=d.useRef(null),[w,N]=d.useState(null),[b,x]=d.useState(r.StartTicks??0),[g,j]=d.useState(r.EndTicks??0),h=d.useRef(b),I=d.useRef(g),A=d.useRef(w),F=d.useRef(null),v=d.useRef(null);let D,G;e[0]!==w||e[1]!==g||e[2]!==b?(D=()=>{h.current=b,I.current=g,A.current=w},G=[b,g,w],e[0]=w,e[1]=g,e[2]=b,e[3]=D,e[4]=G):(D=e[3],G=e[4]),d.useLayoutEffect(D,G);let y,C;e[5]===Symbol.for("react.memo_cache_sentinel")?(y=()=>()=>{F.current!==null&&cancelAnimationFrame(F.current)},C=[],e[5]=y,e[6]=C):(y=e[5],C=e[6]),d.useEffect(y,C);const M=a===l,$=Hs(r.Type);let B;e[7]!==r.Type?(B=$r(r.Type),e[7]=r.Type,e[8]=B):B=e[8];const U=B;let X,W;e[9]!==r.EndTicks||e[10]!==r.StartTicks?(X=()=>{x(r.StartTicks??0),j(r.EndTicks??0)},W=[r.StartTicks,r.EndTicks],e[9]=r.EndTicks,e[10]=r.StartTicks,e[11]=X,e[12]=W):(X=e[11],W=e[12]),d.useEffect(X,W);let Y;e[13]!==g||e[14]!==b||e[15]!==r?(Y=Gs({...r,StartTicks:b,EndTicks:g}),e[13]=g,e[14]=b,e[15]=r,e[16]=Y):Y=e[16];const L=Y,Z=o>0?b/o*100:0,q=o>0?g/o*100:100,_=q-Z;let P;e[17]!==q||e[18]!==Z||e[19]!==_?(P={startPercent:Z,endPercent:q,widthPercent:_},e[17]=q,e[18]=Z,e[19]=_,e[20]=P):P=e[20];const O=P,{startPercent:R,endPercent:K,widthPercent:ae}=O,te=g-b;let ue;e[21]!==a||e[22]!==f?(ue=Ae=>De=>{De.preventDefault(),De.stopPropagation(),N(Ae),f(a),De.target.setPointerCapture(De.pointerId)},e[21]=a,e[22]=f,e[23]=ue):ue=e[23];const le=ue;let E;e[24]!==o?(E=Ae=>{if(!A.current||!p.current)return;const yt=p.current.getBoundingClientRect(),Cr=Math.max(0,Math.min(100,(Ae.clientX-yt.left)/yt.width*100))/100*o;v.current=Cr,F.current===null&&(F.current=requestAnimationFrame(()=>{F.current=null;const Ms=v.current;if(Ms===null)return;const qs=A.current;qs==="start"?x(Math.max(0,Math.min(Ms,I.current-Mt))):qs==="end"&&j(Math.min(o,Math.max(Ms,h.current+Mt)))}))},e[24]=o,e[25]=E):E=e[25];const pe=E;let ee;e[26]!==u||e[27]!==o||e[28]!==r.Id?(ee=Ae=>{if(!A.current)return;F.current!==null&&(cancelAnimationFrame(F.current),F.current=null);const De=v.current;if(De!==null){if(A.current==="start"){const ds=Math.max(0,Math.min(De,I.current-Mt));h.current=ds,x(ds)}else{const ds=Math.min(o,Math.max(De,h.current+Mt));I.current=ds,j(ds)}v.current=null}Ae.target.releasePointerCapture(Ae.pointerId),N(null),r.Id&&u({id:r.Id,start:h.current,end:I.current})},e[26]=u,e[27]=o,e[28]=r.Id,e[29]=ee):ee=e[29];const Se=ee;let ie;e[30]!==g||e[31]!==b||e[32]!==o?(ie=Ae=>De=>{const yt=parseFloat(De.target.value);isNaN(yt)||yt<0||(Ae==="start"&&yt<g&&x(yt),Ae==="end"&&yt>b&&yt<=o&&j(yt))},e[30]=g,e[31]=b,e[32]=o,e[33]=ie):ie=e[33];const he=ie;let de;e[34]!==g||e[35]!==b||e[36]!==u||e[37]!==r.Id||e[38]!==L.valid?(de=()=>{r.Id&&L.valid&&u({id:r.Id,start:b,end:g})},e[34]=g,e[35]=b,e[36]=u,e[37]=r.Id,e[38]=L.valid,e[39]=de):de=e[39];const ne=de;let we;e[40]!==S||e[41]!==r||e[42]!==i?(we=()=>{S(r),zt({type:"positive",message:i("editor.segmentCopiedToClipboard")})},e[40]=S,e[41]=r,e[42]=i,e[43]=we):we=e[43];const fe=we;let oe;e[44]!==a||e[45]!==c?(oe=()=>c(a),e[44]=a,e[45]=c,e[46]=oe):oe=e[46];const z=oe;let Ie;e[47]!==b||e[48]!==m?(Ie=()=>m(b),e[47]=b,e[48]=m,e[49]=Ie):Ie=e[49];const Ce=Ie;let Te;e[50]!==g||e[51]!==m?(Te=()=>m(g),e[50]=g,e[51]=m,e[52]=Te):Te=e[52];const _e=Te;let me;e[53]!==g||e[54]!==b||e[55]!==u||e[56]!==r.Id||e[57]!==L.valid?(me=()=>{r.Id&&L.valid&&u({id:r.Id,start:b,end:g})},e[53]=g,e[54]=b,e[55]=u,e[56]=r.Id,e[57]=L.valid,e[58]=me):me=e[58];const se=me;let ce;e[59]!==g||e[60]!==b?(ce=Ae=>{const De=Mn(Ae.key,Ae.shiftKey,b,g,Mt);De.handled&&(Ae.preventDefault(),x(De.newValue))},e[59]=g,e[60]=b,e[61]=ce):ce=e[61];const ge=ce;let ye;e[62]!==g||e[63]!==b||e[64]!==o?(ye=Ae=>{const De=Ln(Ae.key,Ae.shiftKey,b,g,o,Mt);De.handled&&(Ae.preventDefault(),j(De.newValue))},e[62]=g,e[63]=b,e[64]=o,e[65]=ye):ye=e[65];const Ee=ye;let xe;e[66]!==M||e[67]!==T?(xe=T?{borderColor:M?T.primary:T.primary+"30",boxShadow:M?`0 8px 32px ${T.primary}15`:void 0}:void 0,e[66]=M,e[67]=T,e[68]=xe):xe=e[68];const V=xe;let re;e[69]!==T?(re=T?{color:T.primary}:void 0,e[69]=T,e[70]=re):re=e[70];const Q=re,Ne=`${R}%`,Ve=`${ae}%`;let Me;e[71]!==U||e[72]!==Ne||e[73]!==Ve?(Me={left:Ne,width:Ve,backgroundColor:U,opacity:.7},e[71]=U,e[72]=Ne,e[73]=Ve,e[74]=Me):Me=e[74];const st=Me,Ue=`calc(${R}% - ${Os/2}px)`;let Be;e[75]!==U||e[76]!==Ue?(Be={left:Ue,backgroundColor:U},e[75]=U,e[76]=Ue,e[77]=Be):Be=e[77];const Oe=Be,rt=`calc(${K}% - ${Os/2}px)`;let Le;e[78]!==U||e[79]!==rt?(Le={left:rt,backgroundColor:U},e[78]=U,e[79]=rt,e[80]=Le):Le=e[80];const ke=Le;let Fe;e[81]!==a||e[82]!==f?(Fe=()=>f(a),e[81]=a,e[82]=f,e[83]=Fe):Fe=e[83];const Pe=Fe,Ke=M?"border-primary/60 bg-primary/5 shadow-lg shadow-primary/10":"border-border/50 hover:border-primary/30 hover:bg-card/80";let Re;e[84]!==Ke?(Re=H("group relative rounded-xl border bg-card/50 backdrop-blur-sm p-4 transition-all duration-200",Ke),e[84]=Ke,e[85]=Re):Re=e[85];const Ge="flex items-center justify-between mb-4",xt="flex items-center gap-3";let ze;e[86]===Symbol.for("react.memo_cache_sentinel")?(ze=n.jsx(pn,{className:"size-4 text-muted-foreground/50 cursor-grab opacity-0 group-hover:opacity-100 transition-opacity","aria-hidden":"true"}),e[86]=ze):ze=e[86];const He=hr,We="outline",nt=H("text-white border-0 font-medium px-3 py-1 shadow-sm",$);let be;e[87]!==He||e[88]!==r.Type||e[89]!==nt?(be=n.jsx(He,{variant:We,className:nt,children:r.Type}),e[87]=He,e[88]=r.Type,e[89]=nt,e[90]=be):be=e[90];let at;e[91]!==te?(at=$e(te),e[91]=te,e[92]=at):at=e[92];let lt;e[93]!==at?(lt=n.jsx("span",{className:"text-sm text-muted-foreground font-medium tabular-nums",children:at}),e[93]=at,e[94]=lt):lt=e[94];let Nt;e[95]!==ze||e[96]!==be||e[97]!==lt?(Nt=n.jsxs("div",{className:xt,children:[ze,be,lt]}),e[95]=ze,e[96]=be,e[97]=lt,e[98]=Nt):Nt=e[98];let it;e[99]!==i?(it=i("accessibility.copySegment"),e[99]=i,e[100]=it):it=e[100];let Ye;e[101]!==i?(Ye=i("editor.segmentCopiedToClipboard"),e[101]=i,e[102]=Ye):Ye=e[102];let ot;e[103]!==Q?(ot=n.jsx(yr,{className:"size-4","aria-hidden":"true",style:Q}),e[103]=Q,e[104]=ot):ot=e[104];let qe;e[105]!==fe||e[106]!==it||e[107]!==Ye||e[108]!==ot?(qe=n.jsx(ve,{variant:"ghost",size:"icon-sm",onClick:fe,"aria-label":it,title:Ye,className:"hover:bg-primary/10",children:ot}),e[105]=fe,e[106]=it,e[107]=Ye,e[108]=ot,e[109]=qe):qe=e[109];let ct;e[110]!==i?(ct=i("accessibility.deleteSegment"),e[110]=i,e[111]=ct):ct=e[111];let It;e[112]===Symbol.for("react.memo_cache_sentinel")?(It=n.jsx(xr,{className:"size-4","aria-hidden":"true"}),e[112]=It):It=e[112];let ut;e[113]!==z||e[114]!==ct?(ut=n.jsx(ve,{variant:"ghost",size:"icon-sm",onClick:z,"aria-label":ct,className:"text-destructive/70 hover:text-destructive hover:bg-destructive/10",children:It}),e[113]=z,e[114]=ct,e[115]=ut):ut=e[115];let dt;e[116]!==qe||e[117]!==ut?(dt=n.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[qe,ut]}),e[116]=qe,e[117]=ut,e[118]=dt):dt=e[118];let Pt;e[119]!==Nt||e[120]!==dt?(Pt=n.jsxs("div",{className:Ge,children:[Nt,dt]}),e[119]=Nt,e[120]=dt,e[121]=Pt):Pt=e[121];let wt;e[122]===Symbol.for("react.memo_cache_sentinel")?(wt={padding:`0 ${Os/2}px`},e[122]=wt):wt=e[122];let ft;e[123]!==r.Type||e[124]!==i?(ft=i("segment.sliderGroup",{type:r.Type}),e[123]=r.Type,e[124]=i,e[125]=ft):ft=e[125];const Rt=`segment-${r.Id}-description`,hs=`segment-${r.Id}-description`;let mt;e[126]!==te||e[127]!==g||e[128]!==b||e[129]!==r.Type||e[130]!==i?(mt=i("segment.sliderDescription",{type:r.Type,start:$e(b),end:$e(g),duration:$e(te)}),e[126]=te,e[127]=g,e[128]=b,e[129]=r.Type,e[130]=i,e[131]=mt):mt=e[131];let bt;e[132]!==hs||e[133]!==mt?(bt=n.jsx("span",{id:hs,className:"sr-only",children:mt}),e[132]=hs,e[133]=mt,e[134]=bt):bt=e[134];let gt;e[135]!==st?(gt=n.jsx("div",{className:"absolute top-1 bottom-1 rounded-md transition-all duration-75",style:st}),e[135]=st,e[136]=gt):gt=e[136];let At;e[137]===Symbol.for("react.memo_cache_sentinel")?(At=H("segment-handle absolute top-0 bottom-0 w-3.5 cursor-ew-resize z-10","focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","flex items-center justify-center"),e[137]=At):At=e[137];let Dt;e[138]!==r.Type||e[139]!==i?(Dt=i("segment.startHandle",{type:r.Type}),e[138]=r.Type,e[139]=i,e[140]=Dt):Dt=e[140];const vt=g-Mt;let Je;e[141]!==b?(Je=$e(b),e[141]=b,e[142]=Je):Je=e[142];let Qe;e[143]!==le?(Qe=le("start"),e[143]=le,e[144]=Qe):Qe=e[144];let pt;e[145]===Symbol.for("react.memo_cache_sentinel")?(pt=n.jsx("div",{className:"w-0.5 h-4 bg-white/60 rounded-full"}),e[145]=pt):pt=e[145];let Xe;e[146]!==se||e[147]!==ge||e[148]!==b||e[149]!==Oe||e[150]!==Dt||e[151]!==vt||e[152]!==Je||e[153]!==Qe?(Xe=n.jsx("div",{className:At,style:Oe,role:"slider","aria-label":Dt,"aria-valuemin":0,"aria-valuemax":vt,"aria-valuenow":b,"aria-valuetext":Je,"aria-orientation":"horizontal",tabIndex:0,onPointerDown:Qe,onKeyDown:ge,onBlur:se,children:pt}),e[146]=se,e[147]=ge,e[148]=b,e[149]=Oe,e[150]=Dt,e[151]=vt,e[152]=Je,e[153]=Qe,e[154]=Xe):Xe=e[154];let ht;e[155]===Symbol.for("react.memo_cache_sentinel")?(ht=H("segment-handle absolute top-0 bottom-0 w-3.5 cursor-ew-resize z-10","focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","flex items-center justify-center"),e[155]=ht):ht=e[155];let Ze;e[156]!==r.Type||e[157]!==i?(Ze=i("segment.endHandle",{type:r.Type}),e[156]=r.Type,e[157]=i,e[158]=Ze):Ze=e[158];const St=b+Mt;let Tt;e[159]!==g?(Tt=$e(g),e[159]=g,e[160]=Tt):Tt=e[160];let et;e[161]!==le?(et=le("end"),e[161]=le,e[162]=et):et=e[162];let Et;e[163]===Symbol.for("react.memo_cache_sentinel")?(Et=n.jsx("div",{className:"w-0.5 h-4 bg-white/60 rounded-full"}),e[163]=Et):Et=e[163];let k;e[164]!==ke||e[165]!==Ee||e[166]!==se||e[167]!==g||e[168]!==o||e[169]!==Ze||e[170]!==St||e[171]!==Tt||e[172]!==et?(k=n.jsx("div",{className:ht,style:ke,role:"slider","aria-label":Ze,"aria-valuemin":St,"aria-valuemax":o,"aria-valuenow":g,"aria-valuetext":Tt,"aria-orientation":"horizontal",tabIndex:0,onPointerDown:et,onKeyDown:Ee,onBlur:se,children:Et}),e[164]=ke,e[165]=Ee,e[166]=se,e[167]=g,e[168]=o,e[169]=Ze,e[170]=St,e[171]=Tt,e[172]=et,e[173]=k):k=e[173];let J;e[174]!==gt||e[175]!==Xe||e[176]!==k?(J=n.jsxs("div",{className:"relative h-full w-full",children:[gt,Xe,k]}),e[174]=gt,e[175]=Xe,e[176]=k,e[177]=J):J=e[177];let tt;e[178]!==pe||e[179]!==Se||e[180]!==ft||e[181]!==Rt||e[182]!==bt||e[183]!==J?(tt=n.jsxs("div",{ref:p,className:"relative h-10 bg-muted/50 rounded-lg cursor-pointer mb-4 touch-none overflow-hidden",style:wt,role:"group","aria-label":ft,"aria-describedby":Rt,onPointerMove:pe,onPointerUp:Se,onPointerLeave:Se,children:[bt,J]}),e[178]=pe,e[179]=Se,e[180]=ft,e[181]=Rt,e[182]=bt,e[183]=J,e[184]=tt):tt=e[184];let jt;e[185]!==i?(jt=i("accessibility.seekToStart"),e[185]=i,e[186]=jt):jt=e[186];let Ut;e[187]!==i?(Ut=i("accessibility.seekToStart"),e[187]=i,e[188]=Ut):Ut=e[188];let Ot;e[189]!==Q?(Ot=n.jsx(Bs,{className:"size-3","aria-hidden":"true",style:Q}),e[189]=Q,e[190]=Ot):Ot=e[190];let Vt;e[191]!==Ce||e[192]!==jt||e[193]!==Ut||e[194]!==Ot?(Vt=n.jsx(ve,{variant:"ghost",size:"icon-sm",onClick:Ce,"aria-label":jt,title:Ut,className:"shrink-0 hover:bg-primary/10",children:Ot}),e[191]=Ce,e[192]=jt,e[193]=Ut,e[194]=Ot,e[195]=Vt):Vt=e[195];const Es=`segment-${r.Id}-start`;let Ht;e[196]!==i?(Ht=i("segment.start"),e[196]=i,e[197]=Ht):Ht=e[197];let Bt;e[198]!==Es||e[199]!==Ht?(Bt=n.jsxs("label",{htmlFor:Es,className:"text-sm text-muted-foreground whitespace-nowrap shrink-0",children:[Ht,":"]}),e[198]=Es,e[199]=Ht,e[200]=Bt):Bt=e[200];const js=`segment-${r.Id}-start`,Cs=g-.001;let Kt;e[201]!==b?(Kt=b.toFixed(3),e[201]=b,e[202]=Kt):Kt=e[202];let Gt;e[203]!==he?(Gt=he("start"),e[203]=he,e[204]=Gt):Gt=e[204];const _s=`segment-${r.Id}-start-formatted`;let Wt;e[205]!==ne||e[206]!==js||e[207]!==Cs||e[208]!==Kt||e[209]!==Gt||e[210]!==_s?(Wt=n.jsx(ws,{id:js,type:"number",step:"0.001",min:"0",max:Cs,value:Kt,onChange:Gt,onBlur:ne,className:"w-full sm:w-28 h-8 text-sm font-mono bg-background/50","aria-describedby":_s}),e[205]=ne,e[206]=js,e[207]=Cs,e[208]=Kt,e[209]=Gt,e[210]=_s,e[211]=Wt):Wt=e[211];const Ns=`segment-${r.Id}-start-formatted`;let Yt;e[212]!==b?(Yt=$e(b),e[212]=b,e[213]=Yt):Yt=e[213];let qt;e[214]!==Ns||e[215]!==Yt?(qt=n.jsx("span",{id:Ns,className:"text-xs text-muted-foreground shrink-0 hidden sm:inline tabular-nums",children:Yt}),e[214]=Ns,e[215]=Yt,e[216]=qt):qt=e[216];let Jt;e[217]!==Vt||e[218]!==Bt||e[219]!==Wt||e[220]!==qt?(Jt=n.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[Vt,Bt,Wt,qt]}),e[217]=Vt,e[218]=Bt,e[219]=Wt,e[220]=qt,e[221]=Jt):Jt=e[221];let Qt;e[222]!==i?(Qt=i("accessibility.seekToEnd"),e[222]=i,e[223]=Qt):Qt=e[223];let Xt;e[224]!==i?(Xt=i("accessibility.seekToEnd"),e[224]=i,e[225]=Xt):Xt=e[225];let Zt;e[226]!==Q?(Zt=n.jsx(Bs,{className:"size-3","aria-hidden":"true",style:Q}),e[226]=Q,e[227]=Zt):Zt=e[227];let es;e[228]!==_e||e[229]!==Qt||e[230]!==Xt||e[231]!==Zt?(es=n.jsx(ve,{variant:"ghost",size:"icon-sm",onClick:_e,"aria-label":Qt,title:Xt,className:"shrink-0 hover:bg-primary/10",children:Zt}),e[228]=_e,e[229]=Qt,e[230]=Xt,e[231]=Zt,e[232]=es):es=e[232];const Is=`segment-${r.Id}-end`;let ts;e[233]!==i?(ts=i("segment.end"),e[233]=i,e[234]=ts):ts=e[234];let ss;e[235]!==Is||e[236]!==ts?(ss=n.jsxs("label",{htmlFor:Is,className:"text-sm text-muted-foreground whitespace-nowrap shrink-0",children:[ts,":"]}),e[235]=Is,e[236]=ts,e[237]=ss):ss=e[237];const Ps=`segment-${r.Id}-end`,Rs=b+.001;let rs;e[238]!==g?(rs=g.toFixed(3),e[238]=g,e[239]=rs):rs=e[239];let ns;e[240]!==he?(ns=he("end"),e[240]=he,e[241]=ns):ns=e[241];const As=`segment-${r.Id}-end-formatted`;let as;e[242]!==ne||e[243]!==o||e[244]!==Ps||e[245]!==Rs||e[246]!==rs||e[247]!==ns||e[248]!==As?(as=n.jsx(ws,{id:Ps,type:"number",step:"0.001",min:Rs,max:o,value:rs,onChange:ns,onBlur:ne,className:"w-full sm:w-28 h-8 text-sm font-mono bg-background/50","aria-describedby":As}),e[242]=ne,e[243]=o,e[244]=Ps,e[245]=Rs,e[246]=rs,e[247]=ns,e[248]=As,e[249]=as):as=e[249];const Ds=`segment-${r.Id}-end-formatted`;let ls;e[250]!==g?(ls=$e(g),e[250]=g,e[251]=ls):ls=e[251];let is;e[252]!==Ds||e[253]!==ls?(is=n.jsx("span",{id:Ds,className:"text-xs text-muted-foreground shrink-0 hidden sm:inline tabular-nums",children:ls}),e[252]=Ds,e[253]=ls,e[254]=is):is=e[254];let os;e[255]!==as||e[256]!==is||e[257]!==es||e[258]!==ss?(os=n.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[es,ss,as,is]}),e[255]=as,e[256]=is,e[257]=es,e[258]=ss,e[259]=os):os=e[259];let cs;e[260]!==os||e[261]!==Jt?(cs=n.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 sm:gap-6",children:[Jt,os]}),e[260]=os,e[261]=Jt,e[262]=cs):cs=e[262];let us;e[263]!==i||e[264]!==L.error||e[265]!==L.valid?(us=!L.valid&&n.jsxs("p",{className:"text-sm text-destructive mt-3 flex items-center gap-2",role:"alert",children:[n.jsx("span",{className:"size-1.5 rounded-full bg-destructive"}),L.error??i("validation.StartEnd")]}),e[263]=i,e[264]=L.error,e[265]=L.valid,e[266]=us):us=e[266];let xs;return e[267]!==V||e[268]!==Pe||e[269]!==cs||e[270]!==us||e[271]!==Re||e[272]!==Pt||e[273]!==tt?(xs=n.jsxs("div",{className:Re,style:V,onClick:Pe,children:[Pt,tt,cs,us]}),e[267]=V,e[268]=Pe,e[269]=cs,e[270]=us,e[271]=Re,e[272]=Pt,e[273]=tt,e[274]=xs):xs=e[274],xs});function tl(s){const t=je.c(4);let e;t[0]!==s?({...e}=s,t[0]=s,t[1]=e):e=t[1];let r;return t[2]!==e?(r=n.jsx(hn,{"data-slot":"alert-dialog",...e}),t[2]=e,t[3]=r):r=t[3],r}function sl(s){const t=je.c(4);let e;t[0]!==s?({...e}=s,t[0]=s,t[1]=e):e=t[1];let r;return t[2]!==e?(r=n.jsx(Sn,{"data-slot":"alert-dialog-portal",...e}),t[2]=e,t[3]=r):r=t[3],r}function rl(s){const t=je.c(8);let e,r;t[0]!==s?({className:e,...r}=s,t[0]=s,t[1]=e,t[2]=r):(e=t[1],r=t[2]);let a;t[3]!==e?(a=H("data-open:animate-in data-closed:animate-out data-closed:fade-out-0 data-open:fade-in-0 bg-black/80 duration-100 supports-backdrop-filter:backdrop-blur-xs fixed inset-0 isolate z-50",e),t[3]=e,t[4]=a):a=t[4];let l;return t[5]!==r||t[6]!==a?(l=n.jsx(Tn,{"data-slot":"alert-dialog-overlay",className:a,...r}),t[5]=r,t[6]=a,t[7]=l):l=t[7],l}function nl(s){const t=je.c(11);let e,r,a;t[0]!==s?({className:e,size:a,...r}=s,t[0]=s,t[1]=e,t[2]=r,t[3]=a):(e=t[1],r=t[2],a=t[3]);const l=a===void 0?"default":a;let o;t[4]===Symbol.for("react.memo_cache_sentinel")?(o=n.jsx(rl,{}),t[4]=o):o=t[4];let u;t[5]!==e?(u=H("data-open:animate-in data-closed:animate-out data-closed:fade-out-0 data-open:fade-in-0 data-closed:zoom-out-95 data-open:zoom-in-95 bg-background ring-foreground/5 gap-6 rounded-4xl p-6 ring-1 duration-100 data-[size=default]:max-w-xs data-[size=sm]:max-w-xs data-[size=default]:sm:max-w-md group/alert-dialog-content fixed top-1/2 left-1/2 z-50 grid w-full -translate-x-1/2 -translate-y-1/2 outline-none",e),t[5]=e,t[6]=u):u=t[6];let c;return t[7]!==r||t[8]!==l||t[9]!==u?(c=n.jsxs(sl,{children:[o,n.jsx(yn,{"data-slot":"alert-dialog-content","data-size":l,className:u,...r})]}),t[7]=r,t[8]=l,t[9]=u,t[10]=c):c=t[10],c}function al(s){const t=je.c(8);let e,r;t[0]!==s?({className:e,...r}=s,t[0]=s,t[1]=e,t[2]=r):(e=t[1],r=t[2]);let a;t[3]!==e?(a=H("grid grid-rows-[auto_1fr] place-items-center gap-1.5 text-center has-data-[slot=alert-dialog-media]:grid-rows-[auto_auto_1fr] has-data-[slot=alert-dialog-media]:gap-x-6 sm:group-data-[size=default]/alert-dialog-content:place-items-start sm:group-data-[size=default]/alert-dialog-content:text-left sm:group-data-[size=default]/alert-dialog-content:has-data-[slot=alert-dialog-media]:grid-rows-[auto_1fr]",e),t[3]=e,t[4]=a):a=t[4];let l;return t[5]!==r||t[6]!==a?(l=n.jsx("div",{"data-slot":"alert-dialog-header",className:a,...r}),t[5]=r,t[6]=a,t[7]=l):l=t[7],l}function ll(s){const t=je.c(8);let e,r;t[0]!==s?({className:e,...r}=s,t[0]=s,t[1]=e,t[2]=r):(e=t[1],r=t[2]);let a;t[3]!==e?(a=H("flex flex-col-reverse gap-2 group-data-[size=sm]/alert-dialog-content:grid group-data-[size=sm]/alert-dialog-content:grid-cols-2 sm:flex-row sm:justify-end",e),t[3]=e,t[4]=a):a=t[4];let l;return t[5]!==r||t[6]!==a?(l=n.jsx("div",{"data-slot":"alert-dialog-footer",className:a,...r}),t[5]=r,t[6]=a,t[7]=l):l=t[7],l}function il(s){const t=je.c(8);let e,r;t[0]!==s?({className:e,...r}=s,t[0]=s,t[1]=e,t[2]=r):(e=t[1],r=t[2]);let a;t[3]!==e?(a=H("text-lg font-medium sm:group-data-[size=default]/alert-dialog-content:group-has-data-[slot=alert-dialog-media]/alert-dialog-content:col-start-2",e),t[3]=e,t[4]=a):a=t[4];let l;return t[5]!==r||t[6]!==a?(l=n.jsx(xn,{"data-slot":"alert-dialog-title",className:a,...r}),t[5]=r,t[6]=a,t[7]=l):l=t[7],l}function ol(s){const t=je.c(8);let e,r;t[0]!==s?({className:e,...r}=s,t[0]=s,t[1]=e,t[2]=r):(e=t[1],r=t[2]);let a;t[3]!==e?(a=H("text-muted-foreground *:[a]:hover:text-foreground text-sm text-balance md:text-pretty *:[a]:underline *:[a]:underline-offset-3",e),t[3]=e,t[4]=a):a=t[4];let l;return t[5]!==r||t[6]!==a?(l=n.jsx(bn,{"data-slot":"alert-dialog-description",className:a,...r}),t[5]=r,t[6]=a,t[7]=l):l=t[7],l}function cl(s){const t=je.c(8);let e,r;t[0]!==s?({className:e,...r}=s,t[0]=s,t[1]=e,t[2]=r):(e=t[1],r=t[2]);let a;t[3]!==e?(a=H(e),t[3]=e,t[4]=a):a=t[4];let l;return t[5]!==r||t[6]!==a?(l=n.jsx(ve,{"data-slot":"alert-dialog-action",className:a,...r}),t[5]=r,t[6]=a,t[7]=l):l=t[7],l}function ul(s){const t=je.c(14);let e,r,a,l;t[0]!==s?({className:e,variant:a,size:l,...r}=s,t[0]=s,t[1]=e,t[2]=r,t[3]=a,t[4]=l):(e=t[1],r=t[2],a=t[3],l=t[4]);const o=a===void 0?"outline":a,u=l===void 0?"default":l;let c;t[5]!==e?(c=H(e),t[5]=e,t[6]=c):c=t[6];let m;t[7]!==u||t[8]!==o?(m=n.jsx(ve,{variant:o,size:u}),t[7]=u,t[8]=o,t[9]=m):m=t[9];let f;return t[10]!==r||t[11]!==c||t[12]!==m?(f=n.jsx(vn,{"data-slot":"alert-dialog-cancel",className:c,render:m,...r}),t[10]=r,t[11]=c,t[12]=m,t[13]=f):f=t[13],f}const dl=s=>s.saveToClipboard;function fl({open:s,segment:t,onClose:e,onSave:r,onDelete:a}){const{t:l}=ps(),o=Lt(dl),u=d.useRef(null),c=d.useRef(null),m=d.useRef(t),[f,i]=d.useState(t),[S,T]=d.useState(!1),[p,w]=d.useState(()=>String(t.StartTicks??0)),[N,b]=d.useState(()=>String(t.EndTicks??0));t!==m.current&&(m.current=t,i(t),w(String(t.StartTicks??0)),b(String(t.EndTicks??0))),d.useEffect(()=>{s&&(c.current=document.activeElement)},[s]),d.useEffect(()=>{if(!s)return;const y=window.setTimeout(()=>u.current?.focus(),0);return()=>window.clearTimeout(y)},[s]);const x=d.useCallback(()=>{e(),requestAnimationFrame(()=>{c.current?.focus()})},[e]),{startSeconds:g,endSeconds:j,duration:h,validation:I}=d.useMemo(()=>{const y=f.StartTicks??0,C=f.EndTicks??0;return{startSeconds:y,endSeconds:C,duration:C-y,validation:Gs(f)}},[f]),A=d.useCallback((y,C)=>{const M=Ur(C);M<0||i($=>({...$,[y==="start"?"StartTicks":"EndTicks"]:M}))},[]),F=d.useCallback(()=>{A("start",p),A("end",N),I.valid&&(r(f),x())},[A,p,N,I.valid,f,r,x]),v=d.useCallback(()=>{o(f),zt({type:"positive",message:l("editor.segmentCopiedToClipboard")})},[f,o,l]),D=d.useCallback(()=>{a(f),T(!1),x()},[f,a,x]),G=Hs(f.Type);return n.jsxs(n.Fragment,{children:[n.jsx(Or,{open:s,onOpenChange:y=>!y&&x(),children:n.jsxs(Vr,{className:"sm:max-w-md",children:[n.jsxs(Hr,{children:[n.jsxs(Br,{className:"flex items-center gap-2",children:[l("segment.edit"),n.jsx(hr,{variant:"outline",className:H("text-white border-0 ml-2",G),children:f.Type})]}),n.jsx(Kr,{children:l("editor.slider.title")})]}),n.jsxs("div",{className:"grid gap-4 py-4","aria-describedby":I.valid?void 0:"segment-validation-error",children:[n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[n.jsx(bs,{htmlFor:"segment-type",className:"sm:text-right",children:l("segment.type")}),n.jsx("div",{className:"sm:col-span-3",children:n.jsxs(Gr,{value:f.Type??"Unknown",onValueChange:y=>y&&i(C=>({...C,Type:y})),children:[n.jsx(Wr,{id:"segment-type",children:n.jsx(Yr,{})}),n.jsx(qr,{children:gr.map(y=>n.jsx(Jr,{value:y,children:n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:H("size-3 rounded-full",Hs(y))}),y]})},y))})]})})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[n.jsx(bs,{htmlFor:"segment-start",className:"sm:text-right",children:l("segment.start")}),n.jsxs("div",{className:"sm:col-span-3 flex items-center gap-2",children:[n.jsx(ws,{id:"segment-start",ref:u,type:"text",inputMode:"decimal",value:p,onChange:y=>w(y.target.value),onBlur:()=>A("start",p),className:"font-mono flex-1"}),n.jsx("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:$e(g)})]})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[n.jsx(bs,{htmlFor:"segment-end",className:"sm:text-right",children:l("segment.end")}),n.jsxs("div",{className:"sm:col-span-3 flex items-center gap-2",children:[n.jsx(ws,{id:"segment-end",type:"text",inputMode:"decimal",value:N,onChange:y=>b(y.target.value),onBlur:()=>A("end",N),className:"font-mono flex-1"}),n.jsx("span",{className:"text-sm text-muted-foreground whitespace-nowrap",children:$e(j)})]})]}),n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-4 items-start sm:items-center gap-2 sm:gap-4",children:[n.jsx(bs,{className:"sm:text-right",children:l("segment.duration")}),n.jsxs("div",{className:"sm:col-span-3",children:[n.jsx("span",{className:"text-sm font-mono",children:$e(h)}),n.jsxs("span",{className:"text-sm text-muted-foreground ml-2",children:["(",h.toFixed(3),"s)"]})]})]}),!I.valid&&n.jsx("p",{id:"segment-validation-error",role:"alert",className:"text-sm text-destructive text-center col-span-full",children:I.error??l("validation.StartEnd")})]}),n.jsxs(Qr,{className:"flex-col gap-3 sm:flex-row sm:gap-2",children:[n.jsxs("div",{className:"flex gap-2 w-full sm:w-auto sm:flex-1 order-2 sm:order-1",children:[n.jsxs(ve,{variant:"outline",size:"sm",onClick:v,className:"flex-1 sm:flex-none",children:[n.jsx(yr,{className:"size-4 mr-2"}),"Copy"]}),n.jsxs(ve,{variant:"destructive",size:"sm",onClick:()=>T(!0),className:"flex-1 sm:flex-none",children:[n.jsx(xr,{className:"size-4 mr-2"}),"Delete"]})]}),n.jsxs("div",{className:"flex gap-2 w-full sm:w-auto order-1 sm:order-2",children:[n.jsx(ve,{variant:"outline",onClick:x,className:"flex-1 sm:flex-none",children:l("close")}),n.jsxs(ve,{onClick:F,disabled:!I.valid,className:"flex-1 sm:flex-none",children:[n.jsx(br,{className:"size-4 mr-2"}),l("editor.saveSegment")]})]})]})]})}),n.jsx(tl,{open:S,onOpenChange:T,children:n.jsxs(nl,{children:[n.jsxs(al,{children:[n.jsx(il,{children:l("editor.deleteSureTitle")}),n.jsx(ol,{children:l("editor.deleteSure",{Type:f.Type})})]}),n.jsxs(ll,{children:[n.jsx(ul,{onClick:()=>T(!1),children:l("no")}),n.jsx(cl,{onClick:D,children:l("yes")})]})]})})]})}const ml=s=>s.clipboardSegment,gl=s=>s.vibrantColors;function pl({item:s,fetchSegments:t=!0,className:e}){const{t:r}=ps(),a=gs(_=>_.showVideoPlayer),l=Lt(ml),o=Lt(gl),{getButtonStyle:u,iconColor:c,hasColors:m}=Sr(o),f=qa(),{data:i=[],isLoading:S}=Xr(s.Id??"",{enabled:t&&!!s.Id}),[T,p]=d.useState([]),[w,N]=d.useState(0),[b,x]=d.useState(),[g,j]=d.useState(!1),[h,I]=d.useState(null),A=f.isPending,F=d.useRef(null),v=d.useRef(T);d.useEffect(()=>{v.current=T},[T]);const D=d.useRef(null),G=d.useRef(i);d.useEffect(()=>()=>{D.current&&clearTimeout(D.current),F.current?.abort()},[]);const y=d.useMemo(()=>Zr(s.RunTimeTicks)||0,[s.RunTimeTicks]);if(i.length>0&&i!==G.current){G.current=i;const _=[...i].sort(fs);JSON.stringify(_)!==JSON.stringify(T)&&p(_)}const C=d.useCallback(_=>{const P={Id:Zs(),ItemId:s.Id,Type:_.type,StartTicks:_.start,EndTicks:_.end??_.start+1};p(O=>{const R=[...O,P].sort(fs),K=R.findIndex(ae=>ae.Id===P.Id);return N(K>=0?K:R.length-1),R})},[s.Id]),M=d.useCallback(_=>{p(P=>{if(P.length===0)return P;const O=[...P],R=O[w];return R===void 0?P:(_.start?R.StartTicks=_.currentTime:R.EndTicks=_.currentTime,O.sort(fs))})},[w]),$=d.useCallback(_=>{p(P=>P.map(R=>R.Id===_.id?{...R,StartTicks:_.start,EndTicks:_.end}:R).sort(fs))},[]),B=d.useCallback(_=>{p(P=>{const O=[...P];return O.splice(_,1),N(R=>Math.max(0,Math.min(R,O.length-1))),O})},[]),U=d.useCallback(_=>{D.current&&clearTimeout(D.current),x(_),D.current=setTimeout(()=>x(void 0),100)},[]),X=d.useCallback(_=>{I(_),j(!0)},[]),W=d.useCallback(()=>{j(!1),I(null)},[]),Y=d.useCallback(_=>{p(P=>P.map(R=>R.Id===_.Id?_:R).sort(fs))},[]),L=d.useCallback(_=>{p(P=>P.filter(O=>O.Id!==_.Id)),N(P=>Math.max(0,P-1))},[]),Z=d.useCallback(()=>{if(!l){zt({type:"negative",message:r("editor.noSegmentInClipboard")});return}const _=Gs(l,y);if(!_.valid){zt({type:"negative",message:_.error??"Invalid segment data"});return}const P={...l,Id:Zs(),ItemId:s.Id};p(O=>{const R=[...O,P].sort(fs),K=R.findIndex(ae=>ae.Id===P.Id);return N(K>=0?K:R.length-1),R}),zt({type:"positive",message:"Segment pasted from clipboard"})},[l,s.Id,r,y]),q=d.useCallback(async()=>{if(!s.Id||A)return;F.current?.abort();const _=new AbortController;F.current=_;const P=v.current;try{await f.mutateAsync({itemId:s.Id,existingSegments:i,newSegments:P}),_.signal.aborted||zt({type:"positive",message:r("editor.saveSegment")})}catch{}},[s.Id,A,i,f,r]);return n.jsxs("div",{className:H("flex flex-col gap-6 max-w-6xl mx-auto",e),children:[a&&n.jsx($a,{item:s,timestamp:b,onCreateSegment:C,onUpdateSegmentTimestamp:M}),!a&&n.jsx("div",{className:"flex justify-center",children:n.jsx(ve,{variant:"outline",onClick:()=>C({type:"Intro",start:0}),children:r("editor.newSegment")})}),n.jsx("div",{className:"space-y-4",children:S?n.jsx(In,{count:2}):T.length===0?n.jsx("p",{className:"text-center text-muted-foreground py-8",children:r("editor.noSegments")}):n.jsx("div",{className:"space-y-3",children:T.map((_,P)=>n.jsx("div",{onDoubleClick:()=>X(P),children:n.jsx(el,{segment:_,index:P,activeIndex:w,runtimeSeconds:y,onUpdate:$,onDelete:B,onPlayerTimestamp:U,onSetActive:N})},_.Id))})}),h!==null&&T[h]&&n.jsx(fl,{open:g,segment:T[h],onClose:W,onSave:Y,onDelete:L}),n.jsxs("div",{className:"flex flex-row justify-center gap-4",role:"group","aria-label":r("editor.actions","Segment actions"),children:[n.jsxs("button",{onClick:Z,"aria-label":r("editor.paste","Paste segment from clipboard"),className:H("flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-full text-base font-semibold","sm:flex-none sm:px-10 sm:py-4 sm:text-lg sm:min-w-[var(--spacing-button-min)]","transition-all duration-200 ease-out border-2","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",!m&&"bg-secondary/60 text-muted-foreground hover:bg-secondary hover:text-foreground border-transparent"),style:u(!1),children:[n.jsx(kn,{className:"size-4 sm:size-5","aria-hidden":"true",style:c?{color:c}:void 0}),r("editor.paste","Paste")]}),n.jsxs("button",{onClick:q,disabled:A,"aria-label":r("editor.saveSegment","Save all segments"),"aria-busy":A,"aria-live":"polite",className:H("flex-1 flex items-center justify-center gap-2 px-4 py-3 rounded-full text-base font-semibold","sm:flex-none sm:px-10 sm:py-4 sm:text-lg sm:min-w-[var(--spacing-button-min)]","transition-all duration-200 ease-out border-2","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2","disabled:opacity-50 disabled:cursor-not-allowed",!m&&"bg-primary/20 text-primary border-primary/40 hover:bg-primary/30"),style:u(!0),children:[A?n.jsx(wn,{className:"size-4 sm:size-5 animate-spin","aria-hidden":"true"}):n.jsx(br,{className:"size-4 sm:size-5","aria-hidden":"true"}),A&&n.jsx("span",{className:"sr-only",children:"Saving segments"}),r("editor.saveSegment")]})]})]})}function hl(){const s=je.c(4);let t;s[0]===Symbol.for("react.memo_cache_sentinel")?(t=n.jsx("span",{className:"sr-only",children:"Loading player"}),s[0]=t):t=s[0];let e;s[1]===Symbol.for("react.memo_cache_sentinel")?(e=n.jsx(Ls,{className:"aspect-video w-full rounded-2xl"}),s[1]=e):e=s[1];let r;s[2]===Symbol.for("react.memo_cache_sentinel")?(r=n.jsx(Ls,{className:"h-20 w-full rounded-2xl animate-in fade-in duration-300",style:{animationDelay:"50ms"}}),s[2]=r):r=s[2];let a;return s[3]===Symbol.for("react.memo_cache_sentinel")?(a=n.jsxs("main",{className:"min-h-[var(--spacing-page-min-height-lg)] px-4 py-6 sm:px-6 overflow-auto",role:"status","aria-live":"polite","aria-busy":"true",children:[t,n.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e,n.jsxs("div",{className:"space-y-4",children:[r,n.jsx(Ls,{className:"h-20 w-full rounded-2xl animate-in fade-in duration-300",style:{animationDelay:"100ms"}})]})]})]}),s[3]=a):a=s[3],a}function Il(){const s=je.c(17),{itemId:t}=er.useParams(),{fetchSegments:e}=er.useSearch(),{data:r,isLoading:a,error:l}=en(t);let o;s[0]!==r?(o=r?vr(r,300):null,s[0]=r,s[1]=o):o=s[1];const c=Rn(o||null),m=Lt(yl);let f,i;if(s[2]!==m||s[3]!==c?(f=()=>(m(c),()=>m(null)),i=[c,m],s[2]=m,s[3]=c,s[4]=f,s[5]=i):(f=s[4],i=s[5]),d.useEffect(f,i),a){let w;return s[6]===Symbol.for("react.memo_cache_sentinel")?(w=n.jsx(hl,{}),s[6]=w):w=s[6],w}if(l||!r){const w=l?.message||"Item not found";let N;return s[7]!==w?(N=n.jsx(Pn,{message:w,minHeightClass:"min-h-[var(--spacing-page-min-height-lg)]"}),s[7]=w,s[8]=N):N=s[8],N}let S;s[9]!==c?(S=c&&n.jsx("div",{className:"fixed inset-0 -z-10 transition-colors duration-700",style:{backgroundColor:c.background}}),s[9]=c,s[10]=S):S=s[10];let T;s[11]!==e||s[12]!==r?(T=n.jsx("main",{className:"min-h-[var(--spacing-page-min-height-lg)] px-4 py-6 sm:px-6 overflow-auto",children:n.jsx(Nn,{featureName:"Player",minHeightClass:"min-h-[var(--spacing-page-min-height-lg)]",children:n.jsx(pl,{item:r,fetchSegments:e})})}),s[11]=e,s[12]=r,s[13]=T):T=s[13];let p;return s[14]!==S||s[15]!==T?(p=n.jsxs(n.Fragment,{children:[S,T]}),s[14]=S,s[15]=T,s[16]=p):p=s[16],p}function yl(s){return s.setVibrantColors}export{Il as component};
