import{a as k,j as i,f as A,g as B}from"./tanstack-vendor-X9tglsqn.js";import{c as _,a as z,f as M,R as q,u as W,g as Y,h as G,S as V}from"./index-BKFXkr8z.js";import{u as J,L as K,E as O}from"./async-state-BjAe3N_F.js";import{I as Q}from"./ItemImage-CKE-AbWu.js";import{I as X,S as H}from"./empty-state-Drjy-xDk.js";import{u as P}from"./i18n-vendor-CRTJ2_er.js";import{P as Z,r as ee}from"./ui-vendor-t9Z9dju3.js";import"./jellyfin-vendor-CNS50kak.js";import{R as D}from"./route-error-fallback-DQUJhrY3.js";import{g as se,F as te}from"./feature-error-boundary-B9XhZ3Qj.js";import{u as ae}from"./use-vibrant-color-B2OXiui0.js";import"./react-vendor-CePOuxPV.js";import"./media-vendor-CUSAIUeh.js";const F=t=>t.IndexNumber===0||(t.Name||"").toLowerCase().includes("special"),le=k.memo(function(e){const s=_.c(8),{seasons:a,selectedSeasonId:u,onSeasonSelect:m,vibrantColors:c}=e,{getTabStyle:p,hasColors:g}=J(c??null);let o;if(s[0]!==a){const d=a.filter(ce),S=a.filter(F);o=[...d,...S],s[0]=a,s[1]=o}else o=s[1];const N=o;let f;return s[2]!==p||s[3]!==g||s[4]!==m||s[5]!==N||s[6]!==u?(f=i.jsx("div",{className:"flex gap-2 md:gap-3 overflow-x-auto pb-2 md:pb-3 scrollbar-hide",role:"tablist","aria-label":"Seasons",children:N.map((d,S)=>{const h=d.Id===u,b=d.Name??`Season ${d.IndexNumber??S+1}`;return i.jsx("button",{role:"tab","aria-selected":h,"aria-controls":`season-panel-${d.Id}`,onClick:()=>d.Id&&m(d.Id),className:z("flex-shrink-0 px-4 py-3 md:px-6 md:py-4 rounded-full text-base md:text-lg font-semibold whitespace-nowrap","transition-all duration-200 ease-out border-2","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",!g&&(h?"bg-primary/20 text-primary border-primary/40":"bg-secondary/60 text-muted-foreground hover:bg-secondary hover:text-foreground border-transparent")),style:p(h),children:b},d.Id)})}),s[2]=p,s[3]=g,s[4]=m,s[5]=N,s[6]=u,s[7]=f):f=s[7],f}),U=k.memo(function(e){const s=_.c(36),{episode:a,index:u,onClick:m,vibrantColors:c}=e,{t:p}=P(),g=`S${a.ParentIndexNumber??"?"}E${a.IndexNumber??"?"}`;let o;s[0]!==a.RunTimeTicks?(o=a.RunTimeTicks?Math.round(a.RunTimeTicks/6e8):null,s[0]=a.RunTimeTicks,s[1]=o):o=s[1];const N=o,f=Math.min(u*40,400);let d;s[2]!==c?(d=c?{backgroundColor:c.primary}:void 0,s[2]=c,s[3]=d):d=s[3];const S=d;let h;s[4]!==c?(h=c?{color:c.text}:void 0,s[4]=c,s[5]=h):h=s[5];const b=h,x=a.Name||g,y=N?`${g}: ${x}, ${N} minutes`:`${g}: ${x}`,v=!c&&"bg-card/60 backdrop-blur-sm";let n;s[6]!==v?(n=z("group flex items-center gap-4 p-3 md:p-4 rounded-2xl md:rounded-3xl",v,"hover:shadow-lg hover:shadow-black/10"),s[6]=v,s[7]=n):n=s[7];let l;s[8]!==a?(l=i.jsx(Q,{item:a,maxWidth:192,aspectRatio:"aspect-square",className:"w-full h-full object-cover"}),s[8]=a,s[9]=l):l=s[9];let r;s[10]===Symbol.for("react.memo_cache_sentinel")?(r=z("absolute inset-0 flex items-center justify-center","bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity duration-200"),s[10]=r):r=s[10];let j;s[11]===Symbol.for("react.memo_cache_sentinel")?(j=i.jsx("div",{className:r,"aria-hidden":"true",children:i.jsx(Z,{className:"size-6 md:size-8 text-white fill-white"})}),s[11]=j):j=s[11];let I;s[12]!==l?(I=i.jsxs("div",{className:"relative flex-shrink-0 w-16 h-16 md:w-24 md:h-24 rounded-xl md:rounded-2xl overflow-hidden bg-muted shadow-md",children:[l,j]}),s[12]=l,s[13]=I):I=s[13];const T=a.Name||g;let w;s[14]!==T||s[15]!==b?(w=i.jsx("p",{className:"font-semibold truncate leading-tight text-base md:text-lg",style:b,children:T}),s[14]=T,s[15]=b,s[16]=w):w=s[16];let C;s[17]!==a.Name||s[18]!==g||s[19]!==p?(C=a.Name?g:p("series.episode"),s[17]=a.Name,s[18]=g,s[19]=p,s[20]=C):C=s[20];const L=N&&` Â· ${N} min`;let E;s[21]!==C||s[22]!==L||s[23]!==b?(E=i.jsxs("p",{className:"text-sm md:text-base truncate mt-0.5 md:mt-1 opacity-80",style:b,children:[C,L]}),s[21]=C,s[22]=L,s[23]=b,s[24]=E):E=s[24];let $;s[25]!==w||s[26]!==E?($=i.jsxs("div",{className:"flex-grow min-w-0 py-0.5 md:py-1",children:[w,E]}),s[25]=w,s[26]=E,s[27]=$):$=s[27];let R;return s[28]!==f||s[29]!==y||s[30]!==S||s[31]!==m||s[32]!==$||s[33]!==n||s[34]!==I?(R=i.jsxs(X,{onClick:m,animate:!0,animationDelay:f,className:n,style:S,"aria-label":y,children:[I,$]}),s[28]=f,s[29]=y,s[30]=S,s[31]=m,s[32]=$,s[33]=n,s[34]=I,s[35]=R):R=s[35],R});function ie(t){const e=_.c(40),{seriesId:s,season:a,vibrantColors:u}=t,{t:m}=P(),c=A(),p=!!a.Id;let g;e[0]!==p?(g={enabled:p},e[0]=p,e[1]=g):g=e[1];const{data:o,isLoading:N,error:f,refetch:d}=M(s,a.Id??"",g);let S;e[2]!==o?(S=o===void 0?[]:o,e[2]=o,e[3]=S):S=e[3];const h=S;let b;e[4]!==c?(b=l=>{c({to:"/player/$itemId",params:{itemId:l},search:{fetchSegments:"true"}})},e[4]=c,e[5]=b):b=e[5];const x=b;if(N){const l=a.Name??a.IndexNumber;let r;e[6]!==m||e[7]!==l?(r=m("series.loadingEpisodes",{season:l}),e[6]=m,e[7]=l,e[8]=r):r=e[8];let j;return e[9]!==r?(j=i.jsx(K,{message:r}),e[9]=r,e[10]=j):j=e[10],j}if(f){let l;e[11]!==m?(l=m("series.episodeLoadError"),e[11]=m,e[12]=l):l=e[12];let r;e[13]!==d?(r=()=>d(),e[13]=d,e[14]=r):r=e[14];let j;e[15]!==m?(j=m("common.retry"),e[15]=m,e[16]=j):j=e[16];let I;return e[17]!==l||e[18]!==r||e[19]!==j?(I=i.jsx(O,{message:l,onRetry:r,retryText:j}),e[17]=l,e[18]=r,e[19]=j,e[20]=I):I=e[20],I}if(h.length===0){let l;e[21]!==m?(l=m("series.noEpisodes"),e[21]=m,e[22]=l):l=e[22];let r;return e[23]!==l?(r=i.jsx(H,{message:l}),e[23]=l,e[24]=r):r=e[24],r}if(h.length>30){const l=a.Id??"";let r;return e[25]!==h||e[26]!==x||e[27]!==l||e[28]!==u?(r=i.jsx(ne,{episodes:h,seasonId:l,onEpisodeClick:x,vibrantColors:u}),e[25]=h,e[26]=x,e[27]=l,e[28]=u,e[29]=r):r=e[29],r}const y=`season-panel-${a.Id}`;let v;if(e[30]!==h||e[31]!==x||e[32]!==u){let l;e[34]!==x||e[35]!==u?(l=(r,j)=>i.jsx(U,{episode:r,index:j,onClick:()=>x(r.Id??""),vibrantColors:u},r.Id),e[34]=x,e[35]=u,e[36]=l):l=e[36],v=h.map(l),e[30]=h,e[31]=x,e[32]=u,e[33]=v}else v=e[33];let n;return e[37]!==y||e[38]!==v?(n=i.jsx("div",{className:"space-y-2 md:space-y-3",role:"tabpanel",id:y,children:v}),e[37]=y,e[38]=v,e[39]=n):n=e[39],n}function ne({episodes:t,seasonId:e,onEpisodeClick:s,vibrantColors:a}){const u=k.useRef(null),m=B({count:t.length,getScrollElement:()=>u.current,estimateSize:()=>112,overscan:5});return i.jsx("div",{ref:u,className:"h-[600px] md:h-[700px] overflow-auto",role:"tabpanel",id:`season-panel-${e}`,children:i.jsx("div",{className:"relative w-full",style:{height:`${m.getTotalSize()}px`},children:m.getVirtualItems().map(c=>{const p=t[c.index];return i.jsx("div",{className:"absolute top-0 left-0 w-full py-1 md:py-1.5",style:{transform:`translateY(${c.start}px)`},children:i.jsx(U,{episode:p,index:c.index,onClick:()=>s(p.Id??""),vibrantColors:a})},p.Id)})})})}function re(t){const e=_.c(32),{series:s,seasons:a,vibrantColors:u}=t,{t:m}=P();let c;e[0]!==a?(c=()=>a.find(oe)?.Id??a[0]?.Id??null,e[0]=a,e[1]=c):c=e[1];const p=c;let g;e[2]!==p?(g=()=>p(),e[2]=p,e[3]=g):g=e[3];const[o,N]=k.useState(g);let f;if(e[4]!==a||e[5]!==o){let n;e[7]!==o?(n=l=>l.Id===o,e[7]=o,e[8]=n):n=e[8],f=a.find(n),e[4]=a,e[5]=o,e[6]=f}else f=e[6];const d=f;let S,h;if(e[9]!==p||e[10]!==a||e[11]!==o?(S=()=>{if(a.length===0){N(null);return}o&&a.some(l=>l.Id===o)||N(p())},h=[a,o,p],e[9]=p,e[10]=a,e[11]=o,e[12]=S,e[13]=h):(S=e[12],h=e[13]),k.useEffect(S,h),a.length===0){let n;e[14]===Symbol.for("react.memo_cache_sentinel")?(n=i.jsx(ee,{className:"size-14"}),e[14]=n):n=e[14];let l;e[15]!==m?(l=m("series.noSeasons"),e[15]=m,e[16]=l):l=e[16];let r;return e[17]!==l?(r=i.jsx("div",{className:"max-w-3xl mx-auto px-4",children:i.jsx(H,{icon:n,message:l})}),e[17]=l,e[18]=r):r=e[18],r}let b;e[19]!==a||e[20]!==o||e[21]!==u?(b=i.jsx(le,{seasons:a,selectedSeasonId:o,onSeasonSelect:N,vibrantColors:u}),e[19]=a,e[20]=o,e[21]=u,e[22]=b):b=e[22];let x;e[23]!==d||e[24]!==s||e[25]!==u?(x=d&&s.Id&&i.jsx(ie,{seriesId:s.Id,season:d,vibrantColors:u},d.Id),e[23]=d,e[24]=s,e[25]=u,e[26]=x):x=e[26];let y;e[27]!==x?(y=i.jsx("div",{className:"mt-2 md:mt-4",children:x}),e[27]=x,e[28]=y):y=e[28];let v;return e[29]!==b||e[30]!==y?(v=i.jsxs("div",{className:"max-w-3xl md:max-w-4xl lg:max-w-5xl mx-auto",children:[b,y]}),e[29]=b,e[30]=y,e[31]=v):v=e[31],v}function oe(t){return!F(t)}function ce(t){return!F(t)}function me(){const t=_.c(3);let e;t[0]===Symbol.for("react.memo_cache_sentinel")?(e=i.jsx("span",{className:"sr-only",children:"Loading series"}),t[0]=e):e=t[0];let s;t[1]===Symbol.for("react.memo_cache_sentinel")?(s=i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(V,{className:"h-9 w-24"}),i.jsx(V,{className:"h-8 w-48"})]}),t[1]=s):s=t[1];let a;return t[2]===Symbol.for("react.memo_cache_sentinel")?(a=i.jsxs("main",{className:"h-[var(--spacing-page-min-height-skeleton)] px-4 py-6 sm:px-6 overflow-auto",role:"status","aria-live":"polite","aria-busy":"true",children:[e,i.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[s,i.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map(de)})]})]}),t[2]=a):a=t[2],a}function de(t,e){return i.jsx(V,{className:"h-14 w-full rounded-lg animate-in fade-in duration-300",style:{animationDelay:`${e*50}ms`}},e)}function Ce(){const t=_.c(19),{itemId:e}=q.useParams(),s=W(fe),{data:a,isLoading:u,error:m}=Y(e),{data:c,isLoading:p,error:g}=G(e);let o;t[0]!==a?(o=a?se(a,300):null,t[0]=a,t[1]=o):o=t[1];const f=ae(o||null);let d,S;t[2]!==s||t[3]!==f?(d=()=>(s(f),()=>s(null)),S=[f,s],t[2]=s,t[3]=f,t[4]=d,t[5]=S):(d=t[4],S=t[5]),k.useEffect(d,S);const h=u||p,b=m||g;if(h){let n;return t[6]===Symbol.for("react.memo_cache_sentinel")?(n=i.jsx(me,{}),t[6]=n):n=t[6],n}if(b||!a){const n=b?.message||"Series not found";let l;return t[7]!==n?(l=i.jsx(D,{message:n,minHeightClass:"min-h-[var(--spacing-page-min-height-header)]"}),t[7]=n,t[8]=l):l=t[8],l}if(!c||c.length===0){let n;return t[9]===Symbol.for("react.memo_cache_sentinel")?(n=i.jsx(D,{message:"No seasons found for this series",showRetry:!1,minHeightClass:"min-h-[var(--spacing-page-min-height-header)]"}),t[9]=n):n=t[9],n}let x;t[10]!==f?(x=f&&i.jsx("div",{className:"fixed inset-0 -z-10 transition-colors duration-700",style:{backgroundColor:f.background}}),t[10]=f,t[11]=x):x=t[11];let y;t[12]!==c||t[13]!==a||t[14]!==f?(y=i.jsx("main",{className:"min-h-[var(--spacing-page-min-height-header)] px-4 py-6 sm:px-6 overflow-auto",children:i.jsx(te,{featureName:"Series",minHeightClass:"min-h-[var(--spacing-page-min-height-header)]",children:i.jsx(re,{series:a,seasons:c,vibrantColors:f})})}),t[12]=c,t[13]=a,t[14]=f,t[15]=y):y=t[15];let v;return t[16]!==x||t[17]!==y?(v=i.jsxs(i.Fragment,{children:[x,y]}),t[16]=x,t[17]=y,t[18]=v):v=t[18],v}function fe(t){return t.setVibrantColors}export{Ce as component};
