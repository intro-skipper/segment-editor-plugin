import{aa as z,an as D,J as N,t as O,v as V,ao as $,w as F,ap as q,c as R,aq as K,B as U,ai as G,aj as W,ak as J,al as Y,am as X}from"./index-BTs5NH8z.js";import{a as L,j as l,f as Z}from"./tanstack-vendor-DRhT2kVp.js";import{u as Q}from"./i18n-vendor-fVnzc7mj.js";import{a3 as ee,al as te,r as ae,R as ie}from"./ui-vendor-DfZQjXAX.js";let C=null;async function ye(t,e){C&&await se();const a={playSessionId:z(),itemId:t,mediaSourceId:e??t.replace(/-/g,"")};return await D(async i=>{await i.playstateApi.reportPlaybackStart({playbackStartInfo:{ItemId:t,PlaySessionId:a.playSessionId,MediaSourceId:a.mediaSourceId,CanSeek:!0,PlayMethod:"Transcode"}})}),C=a,a}async function se(t){if(!C)return;const e=C;C=null,await D(async a=>{await a.playstateApi.reportPlaybackStopped({playbackStopInfo:{ItemId:e.itemId,PlaySessionId:e.playSessionId,MediaSourceId:e.mediaSourceId,PositionTicks:t}})})}function re(){return C?.playSessionId??null}function pe(t){if(!(!t||!isFinite(t.currentTime)))return Math.floor(t.currentTime*N.TICKS_PER_SECOND)}function H(t,e){const a=O();return V({serverAddress:a.serverAddress,accessToken:a.accessToken,endpoint:t,query:e})}function ne(t){const{itemId:e,mediaSourceId:a,container:i}=t,s=new URLSearchParams({DeviceId:F(),Static:"true"});return a?s.set("MediaSourceId",a):s.set("MediaSourceId",e.replace(/-/g,"")),i&&s.set("Container",i),H(`Videos/${e}/stream`,s)}function oe(t,e){const{itemId:a,container:i="mp4",audioCodec:s="aac",maxStreamingBitrate:n=14e7,startTimeTicks:o=0}=t,d=re()??z(),c=new URLSearchParams({DeviceId:F(),MediaSourceId:a.replace(/-/g,""),PlaySessionId:d,VideoCodec:"av1,hevc,h264,vp9",AudioCodec:s,VideoBitrate:String(n),AudioBitrate:"384000",AudioSampleRate:"48000",MaxStreamingBitrate:String(n),StartTimeTicks:String(o),TranscodingProtocol:"hls",SegmentContainer:i,MinSegments:"1",BreakOnNonKeyFrames:"True",RequireAvc:"false",EnableAudioVbrEncoding:"true",TranscodingMaxAudioChannels:"6","h264-profile":"high","h264-level":"51","hevc-profile":"main,main10","hevc-level":"186","av1-profile":"main"});return e!==void 0&&c.set("AudioStreamIndex",String(e)),H(`Videos/${a}/master.m3u8`,c)}function ce(t){const{itemId:e,imageType:a="Primary",maxWidth:i,maxHeight:s,quality:n=90,tag:o,fillWidth:d,fillHeight:c}=t,r=new URLSearchParams({quality:String(n)});return i!=null&&r.set("maxWidth",String(i)),s!=null&&r.set("maxHeight",String(s)),d!=null&&r.set("fillWidth",String(d)),c!=null&&r.set("fillHeight",String(c)),o&&r.set("tag",o),H(`Items/${e}/Images/${a}`,r)}function xe(t,e,a){if(!t.Id)return;const i=[t.ImageTags?.Primary?{itemId:t.Id,imageType:"Primary",tag:t.ImageTags.Primary}:null,t.BackdropImageTags?.[0]?{itemId:t.Id,imageType:"Backdrop",tag:t.BackdropImageTags[0]}:null,t.ImageTags?.Thumb?{itemId:t.Id,imageType:"Thumb",tag:t.ImageTags.Thumb}:null,t.ParentThumbItemId?{itemId:t.ParentThumbItemId,imageType:"Thumb"}:null,t.SeriesId&&t.SeriesPrimaryImageTag?{itemId:t.SeriesId,imageType:"Primary",tag:t.SeriesPrimaryImageTag}:null];for(const s of i)if(s){const n=ce({itemId:s.itemId,imageType:s.imageType,maxWidth:e,maxHeight:a,tag:s.tag});if(n)return n}}function Ce(t){const e=t.ImageBlurHashes?.Primary;return e?Object.values(e)[0]:void 0}function le(t){const e=t.MediaSources;if(!e||e.length===0)return null;const a=e[0],i=a.MediaStreams??[],s=i.find(r=>r.Type==="Video"),n=i.find(r=>r.Type==="Audio"),o=a.Container??"",d=s?.Codec??"",c=n?.Codec??"";return!o||!d?null:{container:o,videoCodec:d,audioCodec:c,bitrate:a.Bitrate??void 0}}async function be(t,e,a){if(!t.Id)return{strategy:"hls",url:"",startTime:e?e/N.TICKS_PER_SECOND:void 0};const i=le(t),s=await $(i),n=i?.container,o=a!==void 0&&de(t,a);return s.canDirectPlay&&!o?{strategy:"direct",url:ne({itemId:t.Id,container:n}),startTime:e?e/N.TICKS_PER_SECOND:void 0}:{strategy:"hls",url:oe({itemId:t.Id,startTimeTicks:e},a),startTime:e?e/N.TICKS_PER_SECOND:void 0}}function de(t,e){const a=t.MediaSources;if(!a||a.length===0)return!1;const s=(a[0].MediaStreams??[]).find(n=>n.Type==="Audio");return s?s.Index!==e:!1}class ue{cache=new Map;maxSize;onEvict;constructor(e,a){this.maxSize=Math.max(1,e),this.onEvict=a?.onEvict}get(e){const a=this.cache.get(e);return a!==void 0&&(this.cache.delete(e),this.cache.set(e,a)),a}set(e,a){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxSize){const i=this.cache.keys().next().value;if(i!==void 0){const s=this.cache.get(i);this.cache.delete(i),s!==void 0&&this.invokeEvict(s)}}this.cache.set(e,a)}has(e){return this.cache.has(e)}delete(e){const a=this.cache.get(e),i=this.cache.delete(e);return i&&a!==void 0&&this.invokeEvict(a),i}clear(){this.onEvict&&this.cache.forEach(e=>this.invokeEvict(e)),this.cache.clear()}get size(){return this.cache.size}get capacity(){return this.maxSize}keys(){return this.cache.keys()}values(){return this.cache.values()}invokeEvict(e){try{this.onEvict?.(e)}catch{}}}const k=new ue(q.MAX_BLOB_CACHE_SIZE,{onEvict:t=>{t&&t.startsWith("blob:")&&URL.revokeObjectURL(t)}}),_=new Map;function he(t){const e=k.get(t);if(e)return Promise.resolve(e);let a=_.get(t);return a||(a=(async()=>{try{const i=await fetch(t);if(!i.ok)return null;const s=URL.createObjectURL(await i.blob());return k.set(t,s),s}catch{return null}})(),_.set(t,a),a.finally(()=>_.delete(t)),a)}function Te(t){const e=R.c(5);let a;e[0]!==t?(a=()=>t?k.get(t)??"":"",e[0]=t,e[1]=a):a=e[1];const[i,s]=L.useState(a);let n,o;return e[2]!==t?(n=()=>{if(!t){s("");return}const d=k.get(t);if(d){s(d);return}let c=!1;return he(t).then(r=>{!c&&r&&s(r)}),()=>{c=!0}},o=[t],e[2]=t,e[3]=n,e[4]=o):(n=e[3],o=e[4]),L.useEffect(n,o),i}function me(t){const e=R.c(39),{featureName:a,minHeightClass:i,showNavigation:s,errorMessage:n,onRetry:o}=t,d=i===void 0?"min-h-[var(--spacing-page-min-height-sm)]":i,c=s===void 0?!0:s,{t:r}=Q(),u=Z();let b;e[0]!==u?(b=()=>{u({to:"/"})},e[0]=u,e[1]=b):b=e[1];const j=b;let T;e[2]!==u?(T=()=>{u({to:"/"})},e[2]=u,e[3]=T):T=e[3];const A=T,B=`flex items-center justify-center p-4 ${d}`;let E;e[4]===Symbol.for("react.memo_cache_sentinel")?(E=l.jsx("div",{className:"mx-auto flex size-16 items-center justify-center rounded-full bg-destructive/10",children:l.jsx(ae,{className:"size-8 text-destructive","aria-hidden":"true"})}),e[4]=E):E=e[4];const M=`${a} Error`;let h;e[5]!==a||e[6]!==r||e[7]!==M?(h=r("error.feature_error",{feature:a,defaultValue:M}),e[5]=a,e[6]=r,e[7]=M,e[8]=h):h=e[8];let m;e[9]!==h?(m=l.jsx(G,{className:"text-xl",children:h}),e[9]=h,e[10]=m):m=e[10];let f;e[11]!==n||e[12]!==r?(f=n||r("error.feature_description","This feature encountered an error. You can try again or navigate elsewhere."),e[11]=n,e[12]=r,e[13]=f):f=e[13];let g;e[14]!==f?(g=l.jsx(W,{children:f}),e[14]=f,e[15]=g):g=e[15];let S;e[16]!==g||e[17]!==m?(S=l.jsxs(J,{className:"space-y-4",children:[E,m,g]}),e[16]=g,e[17]=m,e[18]=S):S=e[18];let P;e[19]===Symbol.for("react.memo_cache_sentinel")?(P=l.jsx(ie,{className:"size-4","aria-hidden":"true"}),e[19]=P):P=e[19];let I;e[20]!==r?(I=r("common.retry","Try Again"),e[20]=r,e[21]=I):I=e[21];let v;e[22]!==o||e[23]!==I?(v=l.jsxs(U,{variant:"outline",onClick:o,children:[P,I]}),e[22]=o,e[23]=I,e[24]=v):v=e[24];let y;e[25]!==j||e[26]!==A||e[27]!==c||e[28]!==r?(y=c&&l.jsxs(l.Fragment,{children:[l.jsxs(U,{variant:"outline",onClick:j,children:[l.jsx(ee,{className:"size-4","aria-hidden":"true"}),r("common.go_back","Go Back")]}),l.jsxs(U,{onClick:A,children:[l.jsx(te,{className:"size-4","aria-hidden":"true"}),r("common.home","Home")]})]}),e[25]=j,e[26]=A,e[27]=c,e[28]=r,e[29]=y):y=e[29];let p;e[30]!==v||e[31]!==y?(p=l.jsxs(Y,{className:"flex flex-col gap-3 sm:flex-row sm:justify-center",children:[v,y]}),e[30]=v,e[31]=y,e[32]=p):p=e[32];let x;e[33]!==S||e[34]!==p?(x=l.jsxs(X,{className:"w-full max-w-md text-center",children:[S,p]}),e[33]=S,e[34]=p,e[35]=x):x=e[35];let w;return e[36]!==x||e[37]!==B?(w=l.jsx("div",{className:B,role:"alert","aria-live":"assertive",children:x}),e[36]=x,e[37]=B,e[38]=w):w=e[38],w}function Ee(t){const e=R.c(9),{children:a,featureName:i,minHeightClass:s,showNavigation:n,errorMessage:o}=t,d=n===void 0?!0:n;let c;e[0]!==o||e[1]!==i||e[2]!==s||e[3]!==d?(c=l.jsx(me,{featureName:i,minHeightClass:s,showNavigation:d,errorMessage:o,onRetry:fe}),e[0]=o,e[1]=i,e[2]=s,e[3]=d,e[4]=c):c=e[4];let r;return e[5]!==a||e[6]!==i||e[7]!==c?(r=l.jsx(K,{componentName:i,fallback:c,children:a}),e[5]=a,e[6]=i,e[7]=c,e[8]=r):r=e[8],r}function fe(){return window.location.reload()}export{Ee as F,ue as L,be as a,se as b,pe as c,oe as d,Ce as e,he as f,xe as g,ye as s,Te as u};
