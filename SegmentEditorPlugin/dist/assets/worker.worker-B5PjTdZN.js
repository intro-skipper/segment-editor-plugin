(function(){"use strict";class H{constructor(t,n){this.pixels=t,this.opts=n;const{sigBits:r}=n,o=(x,C,f)=>(x<<2*r)+(C<<r)+f;this.getColorIndex=o;const e=8-r,s=1<<3*r,a=new Uint32Array(s);let u,l,h,m,b,_,c,g,d,D;u=h=b=0,l=m=_=Number.MAX_VALUE;const k=t.length/4;let y=0;for(;y<k;){const x=y*4;if(y++,c=t[x+0],g=t[x+1],d=t[x+2],D=t[x+3],D===0)continue;c=c>>e,g=g>>e,d=d>>e;const C=o(c,g,d);a[C]===void 0&&(a[C]=0),a[C]+=1,c>u&&(u=c),c<l&&(l=c),g>h&&(h=g),g<m&&(m=g),d>b&&(b=d),d<_&&(_=d)}this._colorCount=a.reduce((x,C)=>C>0?x+1:x,0),this.hist=a,this.rmax=u,this.rmin=l,this.gmax=h,this.gmin=m,this.bmax=b,this.bmin=_}get colorCount(){return this._colorCount}}function O(i,t){var n;if(t.length>0){const r=i.data,o=r.length/4;let e,s,a,u,l;for(let h=0;h<o;h++){e=h*4,s=r[e+0],a=r[e+1],u=r[e+2],l=r[e+3];for(let m=0;m<t.length;m++)if(!((n=t[m])!=null&&n.call(t,s,a,u,l))){r[e+3]=0;break}}}return i}class N{constructor(t){this.pipeline=t,this._map={}}names(){return Object.keys(this._map)}has(t){return!!this._map[t]}get(t){return this._map[t]}register(t,n){return this._map[t]=n,this.pipeline}}class Q{constructor(){this.filter=new N(this),this.quantizer=new N(this),this.generator=new N(this)}_buildProcessTasks({filters:t,quantizer:n,generators:r}){return r.length===1&&r[0]==="*"&&(r=this.generator.names()),{filters:t.map(e=>o(this.filter,e)),quantizer:o(this.quantizer,n),generators:r.map(e=>o(this.generator,e))};function o(e,s){let a,u;return typeof s=="string"?a=s:(a=s.name,u=s.options),{name:a,fn:e.get(a),options:u}}}async process(t,n){const{filters:r,quantizer:o,generators:e}=this._buildProcessTasks(n),s=await this._filterColors(r,t),a=await this._generateColors(o,s),u=await this._generatePalettes(e,a);return{colors:a,palettes:u}}_filterColors(t,n){return Promise.resolve(O(n,t.map(({fn:r})=>r)))}_generateColors(t,n){return Promise.resolve(t.fn(n.data,t.options))}async _generatePalettes(t,n){const r=await Promise.all(t.map(({fn:o,options:e})=>Promise.resolve(o(n,e))));return Promise.resolve(r.reduce((o,e,s)=>(o[t[s].name]=e,o),{}))}}function W(i,t){i.onmessage=n=>{const r=n.data,{id:o,payload:e}=r;Promise.resolve(t(...e)).then(s=>{i.postMessage({id:o,type:"return",payload:s})}).catch(s=>{i.postMessage({id:o,type:"error",payload:s.message})})}}function Y(i,t,n){return"#"+((1<<24)+(i<<16)+(t<<8)+n).toString(16).slice(1,7)}function G(i,t,n){i/=255,t/=255,n/=255;const r=Math.max(i,t,n),o=Math.min(i,t,n);let e=0,s=0;const a=(r+o)/2;if(r!==o){const u=r-o;switch(s=a>.5?u/(2-r-o):u/(r+o),r){case i:e=(t-n)/u+(t<n?6:0);break;case t:e=(n-i)/u+2;break;case n:e=(i-t)/u+4;break}e/=6}return[e,s,a]}function S(i,t,n){let r,o,e;function s(a,u,l){return l<0&&(l+=1),l>1&&(l-=1),l<1/6?a+(u-a)*6*l:l<1/2?u:l<2/3?a+(u-a)*(2/3-l)*6:a}if(t===0)r=o=e=n;else{const a=n<.5?n*(1+t):n+t-n*t,u=2*n-a;r=s(u,a,i+1/3),o=s(u,a,i),e=s(u,a,i-1/3)}return[r*255,o*255,e*255]}class w{static applyFilters(t,n){return n.length>0?t.filter(({r,g:o,b:e})=>{var s;for(let a=0;a<n.length;a++)if(!((s=n[a])!=null&&s.call(n,r,o,e,255)))return!1;return!0}):t}static clone(t){return new w(t._rgb,t._population)}get r(){return this._rgb[0]}get g(){return this._rgb[1]}get b(){return this._rgb[2]}get rgb(){return this._rgb}get hsl(){if(!this._hsl){const[t,n,r]=this._rgb;this._hsl=G(t,n,r)}return this._hsl}get hex(){if(!this._hex){const[t,n,r]=this._rgb;this._hex=Y(t,n,r)}return this._hex}get population(){return this._population}toJSON(){return{rgb:this.rgb,population:this.population}}getYiq(){if(!this._yiq){const t=this._rgb;this._yiq=(t[0]*299+t[1]*587+t[2]*114)/1e3}return this._yiq}get titleTextColor(){return this._titleTextColor||(this._titleTextColor=this.getYiq()<200?"#fff":"#000"),this._titleTextColor}get bodyTextColor(){return this._bodyTextColor||(this._bodyTextColor=this.getYiq()<150?"#fff":"#000"),this._bodyTextColor}constructor(t,n){this._rgb=t,this._population=n}}function R(i,t){W(i,(n,r)=>t.process(n,r))}const z=5,I=8-z;class P{constructor(t,n,r,o,e,s,a){this.histogram=a,this._volume=-1,this._avg=null,this._count=-1,this.dimension={r1:t,r2:n,g1:r,g2:o,b1:e,b2:s}}static build(t){const n=new H(t,{sigBits:z}),{rmin:r,rmax:o,gmin:e,gmax:s,bmin:a,bmax:u}=n;return new P(r,o,e,s,a,u,n)}invalidate(){this._volume=this._count=-1,this._avg=null}volume(){if(this._volume<0){const{r1:t,r2:n,g1:r,g2:o,b1:e,b2:s}=this.dimension;this._volume=(n-t+1)*(o-r+1)*(s-e+1)}return this._volume}count(){if(this._count<0){const{hist:t,getColorIndex:n}=this.histogram,{r1:r,r2:o,g1:e,g2:s,b1:a,b2:u}=this.dimension;let l=0;for(let h=r;h<=o;h++)for(let m=e;m<=s;m++)for(let b=a;b<=u;b++){const _=n(h,m,b);t[_]&&(l+=t[_])}this._count=l}return this._count}clone(){const{histogram:t}=this,{r1:n,r2:r,g1:o,g2:e,b1:s,b2:a}=this.dimension;return new P(n,r,o,e,s,a,t)}avg(){if(!this._avg){const{hist:t,getColorIndex:n}=this.histogram,{r1:r,r2:o,g1:e,g2:s,b1:a,b2:u}=this.dimension;let l=0;const h=1<<8-z;let m,b,_;m=b=_=0;for(let c=r;c<=o;c++)for(let g=e;g<=s;g++)for(let d=a;d<=u;d++){const D=n(c,g,d),k=t[D];k&&(l+=k,m+=k*(c+.5)*h,b+=k*(g+.5)*h,_+=k*(d+.5)*h)}l?this._avg=[~~(m/l),~~(b/l),~~(_/l)]:this._avg=[~~(h*(r+o+1)/2),~~(h*(e+s+1)/2),~~(h*(a+u+1)/2)]}return this._avg}contains(t){let[n,r,o]=t;const{r1:e,r2:s,g1:a,g2:u,b1:l,b2:h}=this.dimension;return n>>=I,r>>=I,o>>=I,n>=e&&n<=s&&r>=a&&r<=u&&o>=l&&o<=h}split(){const{hist:t,getColorIndex:n}=this.histogram,{r1:r,r2:o,g1:e,g2:s,b1:a,b2:u}=this.dimension,l=this.count();if(!l)return[];if(l===1)return[this.clone()];const h=o-r+1,m=s-e+1,b=u-a+1,_=Math.max(h,m,b);let c=null,g,d;g=d=0;let D=null;if(_===h){D="r",c=new Uint32Array(o+1);for(let f=r;f<=o;f++){g=0;for(let L=e;L<=s;L++)for(let V=a;V<=u;V++){const v=n(f,L,V);t[v]&&(g+=t[v])}d+=g,c[f]=d}}else if(_===m){D="g",c=new Uint32Array(s+1);for(let f=e;f<=s;f++){g=0;for(let L=r;L<=o;L++)for(let V=a;V<=u;V++){const v=n(L,f,V);t[v]&&(g+=t[v])}d+=g,c[f]=d}}else{D="b",c=new Uint32Array(u+1);for(let f=a;f<=u;f++){g=0;for(let L=r;L<=o;L++)for(let V=e;V<=s;V++){const v=n(L,V,f);t[v]&&(g+=t[v])}d+=g,c[f]=d}}let k=-1;const y=new Uint32Array(c.length);for(let f=0;f<c.length;f++){const L=c[f];L&&(k<0&&L>d/2&&(k=f),y[f]=d-L)}const x=this;function C(f){const L=f+"1",V=f+"2",v=x.dimension[L];let M=x.dimension[V];const q=x.clone(),B=x.clone(),E=k-v,j=M-k;for(E<=j?(M=Math.min(M-1,~~(k+j/2)),M=Math.max(0,M)):(M=Math.max(v,~~(k-1-E/2)),M=Math.min(x.dimension[V],M));!c[M];)M++;let F=y[M];for(;!F&&c[M-1];)F=y[--M];return q.dimension[V]=M,B.dimension[L]=M+1,[q,B]}return C(D)}}class A{_sort(){this._sorted||(this.contents.sort(this._comparator),this._sorted=!0)}constructor(t){this._comparator=t,this.contents=[],this._sorted=!1}push(t){this.contents.push(t),this._sorted=!1}peek(t){return this._sort(),t=typeof t=="number"?t:this.contents.length-1,this.contents[t]}pop(){return this._sort(),this.contents.pop()}size(){return this.contents.length}map(t){return this._sort(),this.contents.map(t)}}const J=.75;function U(i,t){let n=i.size();for(;i.size()<t;){const r=i.pop();if(r&&r.count()>0){const[o,e]=r.split();if(!o||(i.push(o),e&&e.count()>0&&i.push(e),i.size()===n))break;n=i.size()}else break}}const X=(i,t)=>{if(i.length===0||t.colorCount<2||t.colorCount>256)throw new Error("Wrong MMCQ parameters");const n=P.build(i);n.histogram.colorCount;const r=new A((e,s)=>e.count()-s.count());r.push(n),U(r,J*t.colorCount);const o=new A((e,s)=>e.count()*e.volume()-s.count()*s.volume());return o.contents=r.contents,U(o,t.colorCount-o.size()),K(o)};function K(i){const t=[];for(;i.size();){const n=i.pop(),r=n.avg();t.push(new w(r,n.count()))}return t}const Z={targetDarkLuma:.26,maxDarkLuma:.45,minLightLuma:.55,targetLightLuma:.74,minNormalLuma:.3,targetNormalLuma:.5,maxNormalLuma:.7,targetMutesSaturation:.3,maxMutesSaturation:.4,targetVibrantSaturation:1,minVibrantSaturation:.35,weightSaturation:3,weightLuma:6.5,weightPopulation:.5};function $(i){let t=0;return i.forEach(n=>{t=Math.max(t,n.population)}),t}function p(i,t){return i.Vibrant===t||i.DarkVibrant===t||i.LightVibrant===t||i.Muted===t||i.DarkMuted===t||i.LightMuted===t}function tt(i,t,n,r,o,e,s){function a(...l){let h=0,m=0;for(let b=0;b<l.length;b+=2){const _=l[b],c=l[b+1];!_||!c||(h+=_*c,m+=c)}return h/m}function u(l,h){return 1-Math.abs(l-h)}return a(u(i,t),s.weightSaturation,u(n,r),s.weightLuma,o/e,s.weightPopulation)}function T(i,t,n,r,o,e,s,a,u,l){let h=null,m=0;return t.forEach(b=>{const[,_,c]=b.hsl;if(_>=a&&_<=u&&c>=o&&c<=e&&!p(i,b)){const g=tt(_,s,c,r,b.population,n,l);(h===null||g>m)&&(h=b,m=g)}}),h}function nt(i,t,n){const r={Vibrant:null,DarkVibrant:null,LightVibrant:null,Muted:null,DarkMuted:null,LightMuted:null};return r.Vibrant=T(r,i,t,n.targetNormalLuma,n.minNormalLuma,n.maxNormalLuma,n.targetVibrantSaturation,n.minVibrantSaturation,1,n),r.LightVibrant=T(r,i,t,n.targetLightLuma,n.minLightLuma,1,n.targetVibrantSaturation,n.minVibrantSaturation,1,n),r.DarkVibrant=T(r,i,t,n.targetDarkLuma,0,n.maxDarkLuma,n.targetVibrantSaturation,n.minVibrantSaturation,1,n),r.Muted=T(r,i,t,n.targetNormalLuma,n.minNormalLuma,n.maxNormalLuma,n.targetMutesSaturation,0,n.maxMutesSaturation,n),r.LightMuted=T(r,i,t,n.targetLightLuma,n.minLightLuma,1,n.targetMutesSaturation,0,n.maxMutesSaturation,n),r.DarkMuted=T(r,i,t,n.targetDarkLuma,0,n.maxDarkLuma,n.targetMutesSaturation,0,n.maxMutesSaturation,n),r}function rt(i,t,n){if(!i.Vibrant&&!i.DarkVibrant&&!i.LightVibrant){if(!i.DarkVibrant&&i.DarkMuted){let[r,o,e]=i.DarkMuted.hsl;e=n.targetDarkLuma,i.DarkVibrant=new w(S(r,o,e),0)}if(!i.LightVibrant&&i.LightMuted){let[r,o,e]=i.LightMuted.hsl;e=n.targetDarkLuma,i.DarkVibrant=new w(S(r,o,e),0)}}if(!i.Vibrant&&i.DarkVibrant){let[r,o,e]=i.DarkVibrant.hsl;e=n.targetNormalLuma,i.Vibrant=new w(S(r,o,e),0)}else if(!i.Vibrant&&i.LightVibrant){let[r,o,e]=i.LightVibrant.hsl;e=n.targetNormalLuma,i.Vibrant=new w(S(r,o,e),0)}if(!i.DarkVibrant&&i.Vibrant){let[r,o,e]=i.Vibrant.hsl;e=n.targetDarkLuma,i.DarkVibrant=new w(S(r,o,e),0)}if(!i.LightVibrant&&i.Vibrant){let[r,o,e]=i.Vibrant.hsl;e=n.targetLightLuma,i.LightVibrant=new w(S(r,o,e),0)}if(!i.Muted&&i.Vibrant){let[r,o,e]=i.Vibrant.hsl;e=n.targetMutesSaturation,i.Muted=new w(S(r,o,e),0)}if(!i.DarkMuted&&i.DarkVibrant){let[r,o,e]=i.DarkVibrant.hsl;e=n.targetMutesSaturation,i.DarkMuted=new w(S(r,o,e),0)}if(!i.LightMuted&&i.LightVibrant){let[r,o,e]=i.LightVibrant.hsl;e=n.targetMutesSaturation,i.LightMuted=new w(S(r,o,e),0)}}const it=(i,t)=>{t=Object.assign({},Z,t);const n=$(i),r=nt(i,n,t);return rt(r,n,t),r},et=new Q().filter.register("default",(i,t,n,r)=>r>=125&&!(i>250&&t>250&&n>250)).quantizer.register("mmcq",X).generator.register("default",it);R(self,et)})();
