import{a as w,j as i,f as A,g as B}from"./tanstack-vendor-DcxxohBG.js";import{c as _,a as z,g as M,R as q,u as W,h as Y,i as G,S as V}from"./index-RpOviJkQ.js";import{u as J,L as K,E as O}from"./async-state-BuZcYrLg.js";import{I as Q}from"./ItemImage-B3oNue4m.js";import{I as X,S as H}from"./empty-state-D8IVgHti.js";import{u as P}from"./i18n-vendor-WjpEjhp3.js";import{P as Z,r as ee}from"./ui-vendor-Be58-Sc0.js";import{R as D}from"./route-error-fallback-D8To7R5p.js";import{g as se,F as te}from"./feature-error-boundary-BEcF-gHJ.js";import{u as ae}from"./use-vibrant-color-0LLACAur.js";import"./react-vendor-NRF3IDaz.js";import"./jellyfin-vendor-C-_X6ALD.js";import"./media-vendor-CUSAIUeh.js";const F=t=>t.IndexNumber===0||(t.Name||"").toLowerCase().includes("special"),ie=w.memo(function(e){const s=_.c(8),{seasons:a,selectedSeasonId:u,onSeasonSelect:l,vibrantColors:o}=e,{getTabStyle:p,hasColors:x}=J(o??null);let m;if(s[0]!==a){const d=a.filter(oe),y=a.filter(F);m=[...d,...y],s[0]=a,s[1]=m}else m=s[1];const g=m;let f;return s[2]!==p||s[3]!==x||s[4]!==l||s[5]!==g||s[6]!==u?(f=i.jsx("div",{className:"flex gap-2 md:gap-3 overflow-x-auto pb-2 md:pb-3 scrollbar-hide",role:"tablist","aria-label":"Seasons",children:g.map((d,y)=>{const h=d.Id===u,v=d.Name??`Season ${d.IndexNumber??y+1}`;return i.jsx("button",{role:"tab","aria-selected":h,"aria-controls":`season-panel-${d.Id}`,onClick:()=>d.Id&&l(d.Id),className:z("flex-shrink-0 px-4 py-3 md:px-6 md:py-4 rounded-full text-base md:text-lg font-semibold whitespace-nowrap","transition-all duration-200 ease-out border-2","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",!x&&(h?"bg-primary/20 text-primary border-primary/40":"bg-secondary/60 text-muted-foreground hover:bg-secondary hover:text-foreground border-transparent")),style:p(h),children:v},d.Id)})}),s[2]=p,s[3]=x,s[4]=l,s[5]=g,s[6]=u,s[7]=f):f=s[7],f}),U=w.memo(function(e){const s=_.c(36),{episode:a,index:u,onClick:l,vibrantColors:o}=e,{t:p}=P(),x=`S${a.ParentIndexNumber??"?"}E${a.IndexNumber??"?"}`;let m;s[0]!==a.RunTimeTicks?(m=a.RunTimeTicks?Math.round(a.RunTimeTicks/6e8):null,s[0]=a.RunTimeTicks,s[1]=m):m=s[1];const g=m,f=Math.min(u*40,400);let d;s[2]!==o?(d=o?{backgroundColor:o.primary}:void 0,s[2]=o,s[3]=d):d=s[3];const y=d;let h;s[4]!==o?(h=o?{color:o.text}:void 0,s[4]=o,s[5]=h):h=s[5];const v=h,b=a.Name||x,N=g?`${x}: ${b}, ${g} minutes`:`${x}: ${b}`,j=!o&&"bg-card/60 backdrop-blur-sm";let c;s[6]!==j?(c=z("group flex items-center gap-4 p-3 md:p-4 rounded-2xl md:rounded-3xl",j,"hover:shadow-lg hover:shadow-black/10"),s[6]=j,s[7]=c):c=s[7];let r;s[8]!==a?(r=i.jsx(Q,{item:a,maxWidth:192,aspectRatio:"aspect-square",className:"w-full h-full object-cover"}),s[8]=a,s[9]=r):r=s[9];let n;s[10]===Symbol.for("react.memo_cache_sentinel")?(n=z("absolute inset-0 flex items-center justify-center","bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity duration-200"),s[10]=n):n=s[10];let S;s[11]===Symbol.for("react.memo_cache_sentinel")?(S=i.jsx("div",{className:n,"aria-hidden":"true",children:i.jsx(Z,{className:"size-6 md:size-8 text-white fill-white"})}),s[11]=S):S=s[11];let I;s[12]!==r?(I=i.jsxs("div",{className:"relative flex-shrink-0 w-16 h-16 md:w-24 md:h-24 rounded-xl md:rounded-2xl overflow-hidden bg-muted shadow-md",children:[r,S]}),s[12]=r,s[13]=I):I=s[13];const T=a.Name||x;let C;s[14]!==T||s[15]!==v?(C=i.jsx("p",{className:"font-semibold truncate leading-tight text-base md:text-lg",style:v,children:T}),s[14]=T,s[15]=v,s[16]=C):C=s[16];let k;s[17]!==a.Name||s[18]!==x||s[19]!==p?(k=a.Name?x:p("series.episode"),s[17]=a.Name,s[18]=x,s[19]=p,s[20]=k):k=s[20];const L=g&&` Â· ${g} min`;let E;s[21]!==k||s[22]!==L||s[23]!==v?(E=i.jsxs("p",{className:"text-sm md:text-base truncate mt-0.5 md:mt-1 opacity-80",style:v,children:[k,L]}),s[21]=k,s[22]=L,s[23]=v,s[24]=E):E=s[24];let $;s[25]!==C||s[26]!==E?($=i.jsxs("div",{className:"flex-grow min-w-0 py-0.5 md:py-1",children:[C,E]}),s[25]=C,s[26]=E,s[27]=$):$=s[27];let R;return s[28]!==f||s[29]!==N||s[30]!==y||s[31]!==l||s[32]!==$||s[33]!==c||s[34]!==I?(R=i.jsxs(X,{onClick:l,animate:!0,animationDelay:f,className:c,style:y,"aria-label":N,children:[I,$]}),s[28]=f,s[29]=N,s[30]=y,s[31]=l,s[32]=$,s[33]=c,s[34]=I,s[35]=R):R=s[35],R});function re(t){const e=_.c(40),{seriesId:s,season:a,vibrantColors:u}=t,{t:l}=P(),o=A(),p=!!a.Id;let x;e[0]!==p?(x={enabled:p},e[0]=p,e[1]=x):x=e[1];const{data:m,isLoading:g,error:f,refetch:d}=M(s,a.Id??"",x);let y;e[2]!==m?(y=m===void 0?[]:m,e[2]=m,e[3]=y):y=e[3];const h=y;let v;e[4]!==o?(v=r=>{o({to:"/player/$itemId",params:{itemId:r},search:{fetchSegments:"true"}})},e[4]=o,e[5]=v):v=e[5];const b=v;if(g){const r=a.Name??a.IndexNumber;let n;e[6]!==l||e[7]!==r?(n=l("series.loadingEpisodes",{season:r}),e[6]=l,e[7]=r,e[8]=n):n=e[8];let S;return e[9]!==n?(S=i.jsx(K,{message:n}),e[9]=n,e[10]=S):S=e[10],S}if(f){let r;e[11]!==l?(r=l("series.episodeLoadError"),e[11]=l,e[12]=r):r=e[12];let n;e[13]!==d?(n=()=>d(),e[13]=d,e[14]=n):n=e[14];let S;e[15]!==l?(S=l("common.retry"),e[15]=l,e[16]=S):S=e[16];let I;return e[17]!==r||e[18]!==n||e[19]!==S?(I=i.jsx(O,{message:r,onRetry:n,retryText:S}),e[17]=r,e[18]=n,e[19]=S,e[20]=I):I=e[20],I}if(h.length===0){let r;e[21]!==l?(r=l("series.noEpisodes"),e[21]=l,e[22]=r):r=e[22];let n;return e[23]!==r?(n=i.jsx(H,{message:r}),e[23]=r,e[24]=n):n=e[24],n}if(h.length>30){const r=a.Id??"";let n;return e[25]!==h||e[26]!==b||e[27]!==r||e[28]!==u?(n=i.jsx(le,{episodes:h,seasonId:r,onEpisodeClick:b,vibrantColors:u}),e[25]=h,e[26]=b,e[27]=r,e[28]=u,e[29]=n):n=e[29],n}const N=`season-panel-${a.Id}`;let j;if(e[30]!==h||e[31]!==b||e[32]!==u){let r;e[34]!==b||e[35]!==u?(r=(n,S)=>i.jsx(U,{episode:n,index:S,onClick:()=>b(n.Id??""),vibrantColors:u},n.Id),e[34]=b,e[35]=u,e[36]=r):r=e[36],j=h.map(r),e[30]=h,e[31]=b,e[32]=u,e[33]=j}else j=e[33];let c;return e[37]!==N||e[38]!==j?(c=i.jsx("div",{className:"space-y-2 md:space-y-3",role:"tabpanel",id:N,children:j}),e[37]=N,e[38]=j,e[39]=c):c=e[39],c}function le({episodes:t,seasonId:e,onEpisodeClick:s,vibrantColors:a}){const u=w.useRef(null),l=B({count:t.length,getScrollElement:()=>u.current,estimateSize:()=>112,overscan:5});return i.jsx("div",{ref:u,className:"h-[600px] md:h-[700px] overflow-auto",role:"tabpanel",id:`season-panel-${e}`,children:i.jsx("div",{className:"relative w-full",style:{height:`${l.getTotalSize()}px`},children:l.getVirtualItems().map(o=>{const p=t[o.index];return i.jsx("div",{className:"absolute top-0 left-0 w-full py-1 md:py-1.5",style:{transform:`translateY(${o.start}px)`},children:i.jsx(U,{episode:p,index:o.index,onClick:()=>s(p.Id??""),vibrantColors:a})},p.Id)})})})}function ne({series:t,seasons:e,vibrantColors:s}){const{t:a}=P(),u=w.useCallback(()=>e.find(g=>!F(g))?.Id??e[0]?.Id??null,[e]),[l,o]=w.useState(()=>u()),p=e.find(m=>m.Id===l),x=w.useRef(e);if(e!==x.current){if(x.current=e,e.length===0)l!==null&&o(null);else if(!(l?e.some(g=>g.Id===l):!1)){const g=u();g!==l&&o(g)}}return e.length===0?i.jsx("div",{className:"max-w-3xl mx-auto px-4",children:i.jsx(H,{icon:i.jsx(ee,{className:"size-14"}),message:a("series.noSeasons")})}):i.jsxs("div",{className:"max-w-3xl md:max-w-4xl lg:max-w-5xl mx-auto",children:[i.jsx(ie,{seasons:e,selectedSeasonId:l,onSeasonSelect:o,vibrantColors:s}),i.jsx("div",{className:"mt-2 md:mt-4",children:p&&t.Id&&i.jsx(re,{seriesId:t.Id,season:p,vibrantColors:s},p.Id)})]})}function oe(t){return!F(t)}function ce(){const t=_.c(3);let e;t[0]===Symbol.for("react.memo_cache_sentinel")?(e=i.jsx("span",{className:"sr-only",children:"Loading series"}),t[0]=e):e=t[0];let s;t[1]===Symbol.for("react.memo_cache_sentinel")?(s=i.jsxs("div",{className:"flex items-center gap-4",children:[i.jsx(V,{className:"h-9 w-24"}),i.jsx(V,{className:"h-8 w-48"})]}),t[1]=s):s=t[1];let a;return t[2]===Symbol.for("react.memo_cache_sentinel")?(a=i.jsxs("main",{className:"h-[var(--spacing-page-min-height-skeleton)] px-4 py-6 sm:px-6 overflow-auto",role:"status","aria-live":"polite","aria-busy":"true",children:[e,i.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[s,i.jsx("div",{className:"space-y-3",children:Array.from({length:3}).map(me)})]})]}),t[2]=a):a=t[2],a}function me(t,e){return i.jsx(V,{className:"h-14 w-full rounded-lg animate-in fade-in duration-300",style:{animationDelay:`${e*50}ms`}},e)}function we(){const t=_.c(19),{itemId:e}=q.useParams(),s=W(de),{data:a,isLoading:u,error:l}=Y(e),{data:o,isLoading:p,error:x}=G(e);let m;t[0]!==a?(m=a?se(a,300):null,t[0]=a,t[1]=m):m=t[1];const f=ae(m||null);let d,y;t[2]!==s||t[3]!==f?(d=()=>(s(f),()=>s(null)),y=[f,s],t[2]=s,t[3]=f,t[4]=d,t[5]=y):(d=t[4],y=t[5]),w.useEffect(d,y);const h=u||p,v=l||x;if(h){let c;return t[6]===Symbol.for("react.memo_cache_sentinel")?(c=i.jsx(ce,{}),t[6]=c):c=t[6],c}if(v||!a){const c=v?.message||"Series not found";let r;return t[7]!==c?(r=i.jsx(D,{message:c,minHeightClass:"min-h-[var(--spacing-page-min-height-header)]"}),t[7]=c,t[8]=r):r=t[8],r}if(!o||o.length===0){let c;return t[9]===Symbol.for("react.memo_cache_sentinel")?(c=i.jsx(D,{message:"No seasons found for this series",showRetry:!1,minHeightClass:"min-h-[var(--spacing-page-min-height-header)]"}),t[9]=c):c=t[9],c}let b;t[10]!==f?(b=f&&i.jsx("div",{className:"fixed inset-0 -z-10 transition-colors duration-700",style:{backgroundColor:f.background}}),t[10]=f,t[11]=b):b=t[11];let N;t[12]!==o||t[13]!==a||t[14]!==f?(N=i.jsx("main",{className:"min-h-[var(--spacing-page-min-height-header)] px-4 py-6 sm:px-6 overflow-auto",children:i.jsx(te,{featureName:"Series",minHeightClass:"min-h-[var(--spacing-page-min-height-header)]",children:i.jsx(ne,{series:a,seasons:o,vibrantColors:f})})}),t[12]=o,t[13]=a,t[14]=f,t[15]=N):N=t[15];let j;return t[16]!==b||t[17]!==N?(j=i.jsxs(i.Fragment,{children:[b,N]}),t[16]=b,t[17]=N,t[18]=j):j=t[18],j}function de(t){return t.setVibrantColors}export{we as component};
