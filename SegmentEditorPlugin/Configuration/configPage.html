<!DOCTYPE html>
<html lang="en">
<body>
    <div id="SegmentEditor" data-role="page" class="page type-interior pluginConfigurationPage">
        <style>
            body.segment-editor-hide-jf-header header.MuiAppBar-root {
                display: none !important;
            }

            body.segment-editor-hide-jf-header .page.type-interior {
                padding-top: 0 !important;
            }
        </style>
        <script>
            (() => {
                const root = document.getElementById('SegmentEditor');
                if (!root || !document.body || !window) {
                    return;
                }

                const className = 'segment-editor-hide-jf-header';

                const isVisible = () => {
                    if (!document.body.contains(root)) {
                        return false;
                    }

                    if (root.hasAttribute('hidden') || root.getAttribute('aria-hidden') === 'true') {
                        return false;
                    }

                    const style = window.getComputedStyle(root);
                    if (style.display === 'none' || style.visibility === 'hidden' || style.opacity === '0') {
                        return false;
                    }

                    return root.getClientRects().length > 0;
                };

                const syncHeader = () => {
                    document.body.classList.toggle(className, isVisible());
                };

                const stopPlayback = () => {
                    const mediaElements = document.querySelectorAll('video, audio');
                    for (const media of mediaElements) {
                        try {
                            media.pause();
                        } catch {}

                        try {
                            media.removeAttribute('src');
                            const sources = media.querySelectorAll('source');
                            for (const source of sources) {
                                source.removeAttribute('src');
                            }

                            media.load();
                        } catch {}
                    }

                    const dashboard = window.Dashboard;
                    if (dashboard && typeof dashboard.stopPlayback === 'function') {
                        try {
                            dashboard.stopPlayback();
                        } catch {}
                    }
                };

                syncHeader();

                const bodyObserver = new MutationObserver(syncHeader);
                bodyObserver.observe(document.body, { childList: true, subtree: true });

                const rootObserver = new MutationObserver(syncHeader);
                rootObserver.observe(root, {
                    attributes: true,
                    attributeFilter: ['class', 'style', 'hidden', 'aria-hidden'],
                });

                const clearHeader = () => document.body.classList.remove(className);
                const handleNavigationChange = () => {
                    stopPlayback();
                    syncHeader();
                };

                const handlePageExit = () => {
                    stopPlayback();
                    clearHeader();
                };

                window.addEventListener('pagehide', handlePageExit);
                window.addEventListener('beforeunload', handlePageExit);
                window.addEventListener('pageshow', syncHeader);
                window.addEventListener('hashchange', handleNavigationChange);
                window.addEventListener('popstate', handleNavigationChange);
                document.addEventListener('visibilitychange', syncHeader);
            })();
        </script>
        <div data-role="content">
            <div id="app"></div>
        </div>

        <script type="module" crossorigin src="/SegmentEditor/assets/index.js"></script>
        <link rel="modulepreload" crossorigin href="/SegmentEditor/assets/tanstack-vendor.js">
        <link rel="modulepreload" crossorigin href="/SegmentEditor/assets/i18n-vendor.js">
        <link rel="modulepreload" crossorigin href="/SegmentEditor/assets/ui-vendor.js">
        <link rel="modulepreload" crossorigin href="/SegmentEditor/assets/react-vendor.js">
        <link rel="modulepreload" crossorigin href="/SegmentEditor/assets/jellyfin-vendor.js">
        <link rel="modulepreload" crossorigin href="/SegmentEditor/assets/media-vendor.js">
        <link rel="stylesheet" crossorigin href="/SegmentEditor/assets/index.css">
    </div>
</body>
</html>
